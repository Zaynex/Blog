<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="但行好事，莫问前程">
<meta property="og:type" content="website">
<meta property="og:title" content="如是而已">
<meta property="og:url" content="https://zaynex.github.io/index.html">
<meta property="og:site_name" content="如是而已">
<meta property="og:description" content="但行好事，莫问前程">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="如是而已">
<meta name="twitter:description" content="但行好事，莫问前程">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://zaynex.github.io/"/>

  <title> 如是而已 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?af076e316f8f5bf2f10120a932bafe01";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">如是而已</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/28/实习一周小结/" itemprop="url">
                  实习一周小结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-28T23:44:46+08:00" content="2016-11-28">
              2016-11-28
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/28/实习一周小结/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/28/实习一周小结/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>快速学习的能力<br>定位错误，描述错误的能力<br>解决问题的能力<br>找到自己的阶段<br>致本以为能解决的需求。</p>
<p>props是将顶层组件以属性的形式传递，获取里面的方法和变量。<br>如何将state保存到store中？<br>先通过props获取当前的参数，比如 counter<br>再将state的counter赋值给 counter<br>注意到两个counter不一样，一个是当前state里面的。</p>
<p>今天总算完成了第一个需求。<br>其实是自己没看仔细。<br>只要第一个选择器选择后通过action修改 store，第二个组件获取store的数值就可以了。</p>
<p>聊天室的毕业设计因为window的缘故启动失败。<br>另外，还需要配置一些参数。明天再看吧。</p>
<p>改了很多BUG。熟悉了Ant组件。</p>
<p>parseFloat的妙用。</p>
<p>今天没做什么事情，但是react+redux反而渐渐忘了，要补上。</p>
<p>2016.12.6日<br>今天也没做什么事情。开始感到一丝的不安。想到保安还要轮流值班，我的心感到颤动，年轻的时候一定要学更多的东西，让自己更聪明，学会用脑子赚钱而不是纯粹的出卖自己的体力除非迫不得已。</p>
<p>我也不知道为什么坐在空调房里办公的是我，而在外守夜班的却是他们，只有不断赶超别人，才算赶超自己。</p>
<p>实现都快3周了，结果还没有正式的写过一个功能组件。要谈这三星期的收获。我居然说不出来。唯独可能比较有收获的就是git的使用吧。亲身体会了git的工作流，但是git pull 的流程个人还不是特别清楚。<br>我想最大的悲哀莫过于自己看起来很努力其实真的是在浪费时间吧。</p>
<p>一开始可能对自己要求确实有点高了。还是得根据自己的真实需求出发学习啊。<br>所以还是得明确下规划：<br>每天必看的应该是react这本书，而不是JS权威指南，这个随时都可以翻翻，但是解决工作完成业务才是当务之急啊。<br>从明天开始，不管收获多少，都要写一点总结。要不然，你真的不知道日子是怎么过去的。</p>
<p>2016/12/12<br>今天修改了之前遇到的BUG的一个UI。<br>设定其最大宽度和超出宽度时如何显示，css控制文字超出时省略号。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">overflow: hidden;</div><div class="line">text-overflow:ellipsis; /*文字隐藏后添加省略号*/</div><div class="line">white-space: nowrap;</div></pre></td></tr></table></figure>
<p>前端需要把握很多细节。</p>
<p>晚上一定要早点睡。充分的休息~</p>
<p>2016/12/16</p>
<ol>
<li>let  const 的应用场景</li>
<li>传参为数组，项目。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/22/权威指南读书每日计划一/" itemprop="url">
                  权威指南读书每日计划一
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-22T12:51:52+08:00" content="2016-11-22">
              2016-11-22
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/22/权威指南读书每日计划一/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/22/权威指南读书每日计划一/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>img中的src属性也会发起一次get请求。不过img无法实现完整的Ajax，因为其数据交换是单向的：客户端能发送数据到服务器，但服务器的响应一直是图片导致客户端无法轻易从中获取除图片以外的其他信息。</p>
<p>iframe：服务器创建一个包含响应内容的HTML文档，并且返回给浏览器，并在iframe中显示它。</p>
<p>今天花了很多时间学webpack，有点得不偿失。明天做了react的todolist以及极客学院的文档就开始学新的东西。</p>
<p>在路上的时间安排：<br>早晨：以听为主。<br>中午午休：看一会权威指南。<br>晚上回去：看电子书或者听课（根据自己的状态来）</p>
<p>for in 只能遍历可枚举的属性，但包括通过原型上继承的属性。（JS语言核心所定义的内置方法就是不可枚举的，比如 toString ）。在ES5中也可以手动设置一个属性是否可枚举。</p>
<p>枚举属性的顺序</p>
<ol>
<li>按照属性定义的先后顺序来枚举简单对象的属性</li>
<li>如果是对象直接量，则按照对象直接量中属性出现的顺序来枚举。</li>
</ol>
<p>访问一个不存在的属性会返回 undefined<br>但是访问一个不存在的对象的属性就会 报错。<br>最佳方案是采用 &amp;&amp; 操作符<br>比如：<br>var len = undefined;<br>if(book) {<br>    if(book.subtitle) len = book.subtitle.length;<br>}</p>
<p>var len = book &amp;&amp; book.subtitle &amp;&amp; book.subtitle.length</p>
<p>delete只能删除自身属性，无法删除继承的属性，若要删除继承属性，则只能从定义原型对象上删除它。<br>其实delete只是断开了属性和宿主对象的联系，而不会去操作属性中的属性。</p>
<p>a = {p:{x:1}};<br>b = a.p;<br>delete a.p;<br>//a.p访问无效，<br>//但是b.x = 1</p>
<p>delete不可删除那些可配置性为false的属性（但可以删除不可拓展对象的可配置属性）</p>
<p>var random = {<br>    get octet() {return Math.floor(Math.random()<em> 256)},<br>    get uint16() {return Math.floor(Math.random() </em> 65535)}<br>}</p>
<p>var serialnum = {<br>    $n: 0,<br>    get next() {<br>        return this.$n++;<br>    },<br>    get next(n) {<br>        if(n &gt;= this.$n) this.$n = n;<br>        else throw “不能比当前序列小”<br>    }<br>}</p>
<p>如果对象是不可拓展的，则可以编辑已有的自身属性，但不能添加新属性<br>如果属性是不可配置的，则不能修改它的可配置性和可枚举性<br>如果存取器属性是不可配置的，则不能修改其getter和setter方法，也不能将其转为数据属性<br>如果数据属性是不可配置的，则不能转为存取器属性</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/20/你不知道的JS精要/" itemprop="url">
                  你不知道的JS精要
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-20T10:04:05+08:00" content="2016-11-20">
              2016-11-20
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/20/你不知道的JS精要/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/20/你不知道的JS精要/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h2><h3 id="LHS和RHS"><a href="#LHS和RHS" class="headerlink" title="LHS和RHS"></a>LHS和RHS</h3><p>当变量出现在赋值操作的左侧时会进行LHS查询，出现在右侧时会进行RHS查询。（取得他的原值）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">function foo(a)&#123;</div><div class="line">    console.log(a+b);</div><div class="line">    b = a;</div><div class="line">&#125;</div><div class="line">foo(2);</div><div class="line">//VM102:2 Uncaught ReferenceError: b is not defined(…)</div></pre></td></tr></table></figure></p>
<p>首先对 <code>foo</code> 进行 <code>RHS</code> 引用找到<code>foo</code>的值。以为这<code>foo()</code>函数被执行。为了给传递的参数分配值，所以会进行一次 <code>LHS</code> 查询。查询完之后再进行 <code>RHS</code> 查询。（这个参数 <code>a = 2</code>有一个隐形赋值的过程）<br><code>console.log</code>本身也会有一次引用才能执行，因此会对<code>console</code>对象进行 <code>RHS</code> 查询，检查含有<code>log</code>的方法。<br>但是在对b进行RHS查询是没找到该变量，会抛出异常。<br>当引擎执行LHS查询时，如果顶层作用域也没找到目标变量，那就会在全局作用域中创建一个具有该名称的变量，前提是程序运行在严格模式下。<br><code>ReferenceError</code>表示与作用域判别相关的错误，<code>TypeError</code>表示作用域判别成功，但操作结果不合法。</p>
<h3 id="立即执行函数表达式"><a href="#立即执行函数表达式" class="headerlink" title="立即执行函数表达式"></a>立即执行函数表达式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var a = 2;</div><div class="line">(function IIFE(global, undefined)&#123;</div><div class="line">    var a = 3;</div><div class="line">    console.log(a);</div><div class="line">    console.log(global.a);//将window全局对象通过参数传递，分清楚全局和局部变量</div><div class="line">&#125;)(window);</div><div class="line">console.log(a);</div></pre></td></tr></table></figure>
<p>如果 <code>undefined</code> 作为参数可以确保里面的 <code>undefined</code> 就是 <code>undefined</code> </p>
<h3 id="块级作用域"><a href="#块级作用域" class="headerlink" title="块级作用域"></a>块级作用域</h3><p>let 可以产生块级作用域。</p>
<ol>
<li>块级作用域的范围仅在所在位置的<code>{}</code>里。</li>
<li>let 定义的变量没有声明提前</li>
</ol>
<h3 id="提升"><a href="#提升" class="headerlink" title="提升"></a>提升</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a = 2;</div><div class="line">var a;</div><div class="line">console.log(a);//2</div></pre></td></tr></table></figure>
<p>这道题我也会认为是<code>undefined</code>，但答案却是<code>2</code>。<br>虽然我已经意识到声明提前，但是当时在思考的时候还是认为 <code>a = 2</code> 是默认的将<code>a</code>认为全局变量去声明再赋值，后面碰到了<code>var a</code> 后又重新赋值 <code>undefined</code> 了<br>。<br>而实际上代码会这样执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var a;</div><div class="line">a = 2;</div><div class="line">console.log(a);//2</div></pre></td></tr></table></figure></p>
<p><code>var a</code> 在编译阶段被执行，后面的 <code>a = 2</code> 在等待执行阶段。</p>
<p>这里就是undefined了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var a;</div><div class="line">console.log(a);</div><div class="line">a = 2;</div></pre></td></tr></table></figure></p>
<p>只有声明本身会被提升，而赋值和其他逻辑操作符会留在原地。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">foo();</div><div class="line">function foo()&#123;</div><div class="line">    console.log(a);//undefined</div><div class="line">    var a = 2;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>foo()</code> 函数声明提升以及 <code>var a</code>声明提升，所以函数可以执行，并且返回的结果是<code>undefined</code>。 <code>a = 2</code>在<code>console.log()</code>之后执行。</p>
<p>注意，函数表达式是不会声明提前的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">foo();</div><div class="line">var foo = function bar()&#123;</div><div class="line">    //...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>foo()会报错 TypeError。因为 foo 被提升被分配到作用域，但是为 undefined。对 undefined 进行函数调用会报这种错误类型。</p>
<p>bar() 会抛出ReferenceError异常。<br>其实是这样的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var foo;</div><div class="line">foo();</div><div class="line">bar();</div><div class="line"></div><div class="line">foo = function()&#123;</div><div class="line">    var bar = ...self...</div><div class="line">    //...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在执行函数时我们都没有声明bar，所以外部作用域中根本不存在bar。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">foo();</div><div class="line"><span class="keyword">var</span> foo;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</div><div class="line">&#125;;</div><div class="line">foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</div><div class="line">&#125;;</div><div class="line">foo();</div></pre></td></tr></table></figure></p>
<p>先输出1再输入2。<br>这个还比较好解释，var foo()实际上是重复声明了，所以会被忽略。代码真正的执行过程是这样的。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">foo();</div><div class="line"><span class="keyword">var</span> foo;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</div><div class="line">&#125;;</div><div class="line">foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</div><div class="line">&#125;;</div><div class="line">foo();</div></pre></td></tr></table></figure></p>
<p>虽然重复的var声明会被忽略，但是函数声明则会覆盖。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">foo();<span class="comment">//3</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</div><div class="line">&#125;</div><div class="line">foo();<span class="comment">//2</span></div></pre></td></tr></table></figure></p>
<p>后面的foo(){}覆盖了前面的foo(){}.</p>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(a);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> bar;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> baz = foo();</div><div class="line"></div><div class="line">baz();<span class="comment">//2</span></div></pre></td></tr></table></figure>
<p>这个例子中，bar()被正常执行，但是它在自己定义的词法作用域以外的地方执行。</p>
<p>一般来说，当foo()执行完之后，内部的作用域都会被销毁，等到引擎的垃圾回收机制去释放内存。但是因为闭包的存在，即bar()，它维系了foo()函数内部所有的作用域。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(a);</div><div class="line">    &#125;</div><div class="line">    bar(baz);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">fn</span>)</span>&#123;</div><div class="line">    fn();</div><div class="line">&#125;</div><div class="line">foo();</div></pre></td></tr></table></figure>
<p>baz()最后执行时在bar的作用域下，但是依然能获取到a值，就说明了闭包的存在。</p>
<p>也可以通过全局作用域来将内部函数传递到自己所在的词法作用域(词法作用域简单点说就是定义词法时所在的作用域，你可以理解为定义一个变量或者是函数)之外执行。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fn;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(a);</div><div class="line">    &#125;</div><div class="line">    fn = baz;<span class="comment">//baz分配到全局变量</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    fn();</div><div class="line">&#125;;</div><div class="line"></div><div class="line">foo();</div><div class="line">bar();</div></pre></td></tr></table></figure>
<h3 id="闭包与循环"><a href="#闭包与循环" class="headerlink" title="闭包与循环"></a>闭包与循环</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;=<span class="number">5</span>; i++)&#123;</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(i);</div><div class="line">    &#125;, i *<span class="number">1000</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述执行过程 5个6，每隔一秒显示。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;=<span class="number">5</span>; i++)&#123;</div><div class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> j = i;</div><div class="line">        setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(j);</div><div class="line">            &#125;, j*<span class="number">1000</span>);</div><div class="line">    &#125;)();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;=<span class="number">5</span>; i++)&#123;</div><div class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params">j</span>)</span>&#123;</div><div class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(j);</div><div class="line">        &#125;, j * <span class="number">1000</span>);</div><div class="line">    &#125;)(i);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>IIFE()会为每隔迭代创建一个新的作用域，使得延时回调函数可以将新的作用域封闭在每个迭代内部。再利用参数来存储每个i的值。</p>
<h3 id="利用块级作用域"><a href="#利用块级作用域" class="headerlink" title="利用块级作用域"></a>利用块级作用域</h3><p>之前的IIFE中每次迭代都需要创建一个块级作用域，所以可以直接用<code>let</code>来代替。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;=<span class="number">5</span>; i++)&#123;</div><div class="line">    <span class="keyword">let</span> j = i;</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(j);</div><div class="line">    &#125;, j* <span class="number">1000</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="模块模式"><a href="#模块模式" class="headerlink" title="模块模式"></a>模块模式</h3><p>这个虽然在高程中也有讲，在拖拽的例子中也采用模块模式的方式去实现，但是还是本书讲解比较细致。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">CoolModule</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> something = <span class="string">"cool"</span>;</div><div class="line">    <span class="keyword">var</span> anther = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(something + <span class="string">"! Module"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">doAnther</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(anther.join(<span class="string">"!"</span>));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        doSomething: doSomething,</div><div class="line">        doAnther: doAnther</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> foo = CoolModule();</div><div class="line">foo.doSomething();</div><div class="line">foo.doAnther();</div></pre></td></tr></table></figure></p>
<p>模块模式的两个必要条件</p>
<ol>
<li>必须有外部的封闭函数，该函数必须至少被调用一次（被调用之后才能创建一个新的模块实例）</li>
<li>封闭函数必须至少返回一个内部函数（暴露接口啊，不然怎么调用呢？），这样内部函数才能在私有作用域中形成闭包，并且可以访问或者修改其他私有状态。</li>
</ol>
<p>一个具备函数属性的对象并不是真正的模块。一个从函数调用所返回的，只有数据属性而没有闭包函数的对象都不是真正的模块。</p>
<p>上面这个函数需要再调用一次，索性我们改成IIFE。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> foo = (<span class="function"><span class="keyword">function</span> <span class="title">CoolModule</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> something = <span class="string">"cool"</span>;</div><div class="line">        <span class="keyword">var</span> anther = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(something + <span class="string">"! Module"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">doAnther</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(anther.join(<span class="string">"!"</span>));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            doSomething: doSomething,</div><div class="line">            doAnther: doAnther</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">)();</div><div class="line"></div><div class="line">foo.doSomething();</div><div class="line">foo.doAnther();</div></pre></td></tr></table></figure></p>
<p>这就是一个很酷的单例模式了。</p>
<p>模块模式另一个强大之处在于可以命名将要作为公共API返回的对象<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> foo = (<span class="function"><span class="keyword">function</span> <span class="title">CoolModule</span>(<span class="params">id</span>)</span>&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        publicAPI.identify = identify2;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">identify1</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(id);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">identify2</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(id.toUpperCase());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> publicAPI = &#123;</div><div class="line">        change: change,</div><div class="line">        identify: identify1</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">return</span> publicAPI;</div><div class="line">&#125;)(<span class="string">'foo module'</span>);</div><div class="line"></div><div class="line">foo.identify();</div><div class="line">foo.change();</div><div class="line">foo.identify();</div></pre></td></tr></table></figure></p>
<p>通过在模块实例的内部保留对公共API对象的内部引用，可以从内部对模块实例进行修改。</p>
<h3 id="现代模块机制"><a href="#现代模块机制" class="headerlink" title="现代模块机制"></a>现代模块机制</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MyModules = (<span class="function"><span class="keyword">function</span> <span class="title">Manager</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> modules = &#123;&#125;;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">define</span>(<span class="params">name, deps, impl</span>)</span>&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; deps.length; i++)&#123;</div><div class="line">            deps[i] = modules[deps[i]];</div><div class="line">        &#125;;</div><div class="line">        <span class="comment">//为模块的定义引入了包装函数（可以传入任意依赖）</span></div><div class="line">        modules[name] = impl.apply(impl, deps);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> modules[name];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        define: define,</div><div class="line">        get: get</div><div class="line">    &#125;</div><div class="line">&#125;)();</div><div class="line"></div><div class="line"></div><div class="line">MyModules.define(<span class="string">'bar'</span>, [], <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">who</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'Let me introduce:'</span> + who;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        hello: hello</div><div class="line">    &#125;;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">MyModules.define(<span class="string">'foo'</span>, [<span class="string">'bar'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">bar</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> hurry = <span class="string">'hippo'</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">awesome</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(bar.hello(hurry).toUpperCase());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        awesome: awesome</div><div class="line">    &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><p>以前一直以为箭头函数的作用就是取代了function的重复声明。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> foo = a =&gt; &#123;</div><div class="line">    <span class="built_in">console</span>.log(a);</div><div class="line">&#125;</div><div class="line"></div><div class="line">foo(<span class="number">2</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(a);</div><div class="line">&#125;</div><div class="line">foo(<span class="number">2</span>);</div></pre></td></tr></table></figure></p>
<p>其实箭头函数更强大的地方在于维系了this的指向。使用当前的词法作用域覆盖了this本来的指向。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    count: <span class="number">0</span>,</div><div class="line">    cool: <span class="function"><span class="keyword">function</span> <span class="title">coolFoo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">if</span>(self.count &lt; <span class="number">1</span>)&#123;</div><div class="line">            setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                self.count++;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'awesome?'</span>);</div><div class="line">            &#125;, <span class="number">1000</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    count: <span class="number">0</span>,</div><div class="line">    cool: <span class="function"><span class="keyword">function</span> <span class="title">coolFoo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.count &lt; <span class="number">1</span>)&#123;</div><div class="line">            setTimeout(()=&gt; &#123;</div><div class="line">                <span class="keyword">this</span>.count++;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'awesome？'</span>);</div><div class="line">            &#125;, <span class="number">1000</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>不过这样反而不利于我们对this的理解。this指向的4种情况我的博客里原来也有写。<br>另外一方面箭头函数是没有名称的，不利于定位错误。<br>最佳写法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">var obj = &#123;</div><div class="line">    count: 0,</div><div class="line">    cool: function coolFoo()&#123;</div><div class="line">        if(this.count &lt; 1)&#123;</div><div class="line">            setTimeout(function timer()&#123;</div><div class="line">                this.count++;</div><div class="line">                console.log(&apos;more awesome&apos;);</div><div class="line">            &#125;.bind(this), 1000);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">obj.cool();</div></pre></td></tr></table></figure></p>
<h2 id="第二部分-this和原型"><a href="#第二部分-this和原型" class="headerlink" title="第二部分 this和原型"></a>第二部分 this和原型</h2><p>this其实就是在函数被调用时发生的绑定，它指向什么取决于函数在哪里被调用。</p>
<h3 id="普通调用this指向全局"><a href="#普通调用this指向全局" class="headerlink" title="普通调用this指向全局"></a>普通调用this指向全局</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">function foo()&#123;</div><div class="line">    console.log(this.a);</div><div class="line">&#125;</div><div class="line">var a= 2;</div><div class="line">(function()&#123;</div><div class="line">    &apos;use strict&apos;;</div><div class="line">    foo();</div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<p>注意，这里虽然IIFE在严格模式下运行，但foo真正的执行并没有严格模式的限制，所以可以取到全局的a.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line"><span class="meta">    'use strict'</span>;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果foo()运行在严格模式下，那就无法将this绑定了全局了。</p>
<h3 id="隐式绑定"><a href="#隐式绑定" class="headerlink" title="隐式绑定"></a>隐式绑定</h3><p>函数作为某个对象的属性并且被调用时，函数中的this指向那个对象。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj1 = &#123;</div><div class="line">    a: <span class="number">42</span>,</div><div class="line">    foo: foo</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">obj1.foo();<span class="comment">//42</span></div></pre></td></tr></table></figure></p>
<p>这里foo函数作为obj这个对象的引用属性。</p>
<p>不过再深入一些就有意思了。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj1 = &#123;</div><div class="line">    a: <span class="number">42</span>,</div><div class="line">    foo: foo</div><div class="line">&#125;</div><div class="line"></div><div class="line">obj1.foo();<span class="comment">//42</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> obj2 = &#123;</div><div class="line">    a: <span class="number">44</span>,</div><div class="line">    obj1: obj1</div><div class="line">&#125;</div><div class="line">obj2.obj1.foo();</div></pre></td></tr></table></figure></p>
<p>这里的话，this指向的是最后被调用的那个上下文对象。这里是之前我的博客里没有分析到的。</p>
<h3 id="隐式绑定的坑"><a href="#隐式绑定的坑" class="headerlink" title="隐式绑定的坑"></a>隐式绑定的坑</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    a: <span class="number">2</span>,</div><div class="line">    foo: foo</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> bar = obj.foo;</div><div class="line"><span class="keyword">var</span> a = <span class="string">'global'</span>;</div><div class="line">bar();<span class="comment">//global</span></div></pre></td></tr></table></figure>
<p>实际上bar引用的是foo函数本身。因为bar是不带任何修饰的函数调用，发生了默认绑定。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doFoo</span>(<span class="params">fn</span>)</span>&#123;</div><div class="line">    fn();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    a: <span class="number">2</span>,</div><div class="line">    foo: foo</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> a= <span class="string">'global'</span>;</div><div class="line">doFoo(obj.foo);</div></pre></td></tr></table></figure>
<p>传递参数时也发生了隐式绑定。即全局作用域。<br>在setTimeout方法中传入的回调函数也会失去绑定，而发生隐式绑定到全局对象。</p>
<h2 id="显式绑定"><a href="#显式绑定" class="headerlink" title="显式绑定"></a>显式绑定</h2><p>call和apply</p>
<h3 id="硬绑定"><a href="#硬绑定" class="headerlink" title="硬绑定"></a>硬绑定</h3><p>强行改变函数上下文。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    a: <span class="number">1</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    foo.call(obj)</div><div class="line">&#125;</div><div class="line"></div><div class="line">bar();<span class="comment">//1</span></div><div class="line">setTimeout(bar, <span class="number">2000</span>); <span class="comment">//1</span></div><div class="line">bar.call(<span class="built_in">window</span>); <span class="comment">//1</span></div></pre></td></tr></table></figure>
<p>最后再修改它this的指向，依然没有效果。</p>
<p>简易的bind<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bind</span>(<span class="params">fn, obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> fn.apply(obj, <span class="built_in">arguments</span>);</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="new绑定"><a href="#new绑定" class="headerlink" title="new绑定"></a>new绑定</h3><p>先说new的作用：</p>
<ol>
<li>创建一个新的空对象</li>
<li>设置该对象内部指针[<strong>proto</strong>]指向构造函数的原型</li>
<li>将该对象绑定到函数调用的this</li>
<li>如果函数没有返回其他对象，那么new表达式中的函数调用会自动返回该对象</li>
</ol>
<h3 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h3><ol>
<li>函数是否调用 new 操作符</li>
<li>函数是否通过call,apply显示绑定或硬绑定</li>
<li>函数是否在上下文中调用(隐式绑定)</li>
<li>默认绑定，严格模式下为 undefined</li>
</ol>
<h3 id="其他的细节"><a href="#其他的细节" class="headerlink" title="其他的细节"></a>其他的细节</h3><p>如果把 null  或者 undefined 传入到call apply 或者 bind 中。这些值在调用时会被忽略，发生的是默认绑定。</p>
<p>对于默认绑定来说，决定this绑定对象的并不是调用为止是否处于严格模式，而是函数体是否处于严格模式。如果函数体处于严格模式，那么this就会被绑定到undefined</p>
<h3 id="软绑定"><a href="#软绑定" class="headerlink" title="软绑定"></a>软绑定</h3><p>硬绑定无法修改后来想要绑定的this指向，不够变通。我们就需要软绑定来让this指向除了全局对象和undefined以外的值。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(!<span class="built_in">Function</span>.prototype.softBind) &#123;</div><div class="line">    <span class="built_in">Function</span>.prototype.softBind = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> fn = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">var</span> curried = [].slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</div><div class="line">        <span class="keyword">var</span> bound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> fn.apply((!<span class="keyword">this</span> || <span class="keyword">this</span> === (<span class="built_in">window</span> || global)) ? obj : <span class="keyword">this</span>, curried.concat.apply(curried, <span class="built_in">arguments</span>));</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        bound.prototype = <span class="built_in">Object</span>.create(fn.prototype);</div><div class="line">        <span class="keyword">return</span> bound;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="箭头函数的this"><a href="#箭头函数的this" class="headerlink" title="箭头函数的this"></a>箭头函数的this</h3><p>箭头函数中的this 是有外层函数（或全局）作用域来决定this。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    setTimeout(() =&gt; &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">        &#125;, <span class="number">1000</span></div><div class="line"></div><div class="line">        )</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    a: <span class="number">2</span></div><div class="line">&#125;</div><div class="line">foo.call(obj);</div></pre></td></tr></table></figure>
<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><p>在对象中的所有属性名都是字符串，如果不是也会被转换。（数组中的下标使用的是数组）<br>ES6新增可计算属性名：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> prefix = <span class="string">"foo"</span>;</div><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">    [prefix + <span class="string">'bar'</span>]: <span class="string">'hello bar'</span>,</div><div class="line">    [prefix + <span class="string">'foo'</span>]: <span class="string">'hello foo'</span></div><div class="line">&#125;;</div><div class="line">myObject[<span class="string">'foobar'</span>];</div><div class="line">myObject[<span class="string">'foofoo'</span>];</div></pre></td></tr></table></figure></p>
<h3 id="复制对象"><a href="#复制对象" class="headerlink" title="复制对象"></a>复制对象</h3><p>JSON方式，可以被序列化为JSON字符处啊并且可以根据这个字符串解构出一个结构和值完全一样的对象。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> newObj = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(someObj));</div></pre></td></tr></table></figure></p>
<p>浅复制还可以采用ES6的 Object.assign()<br>Object.assign() 第一个参数时目标对象，之后跟多个源对象。<br>它会遍历所有可枚举的自有属性并复制到目标对象。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">    a: <span class="number">1</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> newObj = <span class="built_in">Object</span>.assign(&#123;&#125;, myObject);</div><div class="line">newObj.a; <span class="comment">//1</span></div></pre></td></tr></table></figure></p>
<h3 id="ES5属性描述符"><a href="#ES5属性描述符" class="headerlink" title="ES5属性描述符"></a>ES5属性描述符</h3><ul>
<li>writable: 是否可写</li>
<li>configurable: 是否可修改属性描述符</li>
<li>enumerable: 是否可以遍历</li>
</ul>
<p>小例外： 如果configurable 属性为 false，但是依然可以修改 writable 为 true 到 false, 反之则不行。</p>
<h3 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h3><p><code>for in</code> 其实遍历的是每个属性。<br><code>for of</code> 遍历的是每个属性。但只能遍历到最外层。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/09/新浪浙江笔试题/" itemprop="url">
                  记一发前端笔试题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-09T22:28:25+08:00" content="2016-11-09">
              2016-11-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/09/新浪浙江笔试题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/09/新浪浙江笔试题/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="HTML-CSS部分"><a href="#HTML-CSS部分" class="headerlink" title="HTML/CSS部分"></a>HTML/CSS部分</h2><h3 id="display-none-和-visibility-hidden"><a href="#display-none-和-visibility-hidden" class="headerlink" title="display:none 和 visibility:hidden"></a><code>display:none</code> 和 <code>visibility:hidden</code></h3><p><code>display:none</code>：关闭一个元素的显示（对布局没有影响）；其所有后代元素都也被会被关闭显示。文档渲染时，该元素如同不存在。<br><code>visibility:hidden</code>：隐藏元素，但是其他元素的布局不改变，相当于此元素变成透明。要注意若将其子元素设为 visibility: visible，则该子元素依然可见。</p>
<p>注意两点区别:</p>
<ol>
<li>文档渲染的区别，为none时不加载，我记得在某本书里有提到这种措施，可以减少重绘和回流;</li>
<li>前者不占据宽高，页面不显示，后者占据相应的宽高;</li>
<li>前者后代元素也跟随该元素消失，后者子代元素依然可见。</li>
</ol>
<h4 id="重绘与回流"><a href="#重绘与回流" class="headerlink" title="重绘与回流"></a>重绘与回流</h4><p>#####为什么不none时不加载呢？</p>
<blockquote>
<p>DOM Tree 和样式结构体组合后构建render tree, render tree类似于DOM tree，但区别很大，render tree能识别样式，render tree中每个NODE都有自己的style，而且 render tree不包含隐藏的节点 (比如display:none的节点，还有head节点)，因为这些节点不会用于呈现，而且不会影响呈现的，所以就不会包含到 render tree中。注意 visibility:hidden隐藏的元素还是会包含到 render tree中的，因为visibility:hidden 会影响布局(layout)，会占有空间。根据CSS2的标准，render tree中的每个节点都称为Box (Box dimensions)，理解页面元素为一个具有填充、边距、边框和位置的盒子。</p>
</blockquote>
<p>参考<a href="http://www.css88.com/archives/4996" target="_blank" rel="external">页面重绘和回流以及优化</a></p>
<p>#####回流与重绘</p>
<ol>
<li>当render tree中的一部分(或全部)因为元素的规模尺寸，布局，隐藏等改变而需要重新构建。这就称为回流(reflow)。每个页面至少需要一次回流，就是在页面第一次加载的时候。在回流的时候，浏览器会使渲染树中受到影响的部分失效，并重新构造这部分渲染树，完成回流后，浏览器会重新绘制受影响的部分到屏幕中，该过程成为重绘。</li>
<li>当render tree中的一些元素需要更新属性，而这些属性只是影响元素的外观，风格，而不会影响布局的，比如background-color。则就叫称为重绘。<br><em>注意：回流必将引起重绘，而重绘不一定会引起回流。</em></li>
</ol>
<p>#####show me the code<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var s = document.body.style;</div><div class="line">s.padding = &quot;2px&quot;; // 回流+重绘</div><div class="line">s.border = &quot;1px solid red&quot;; // 再一次 回流+重绘</div><div class="line">s.color = &quot;blue&quot;; // 再一次重绘</div><div class="line">s.backgroundColor = &quot;#ccc&quot;; // 再一次 重绘</div><div class="line">s.fontSize = &quot;14px&quot;; // 再一次 回流+重绘</div><div class="line">// 添加node，再一次 回流+重绘</div><div class="line">document.body.appendChild(document.createTextNode(&apos;abc!&apos;));</div></pre></td></tr></table></figure></p>
<p>但是浏览器也不傻，他们会把这些操作放入到队列里，等到一定数量或者一定间隔再执行操作，就可以减少回流重绘。</p>
<h3 id="行内元素和块级元素"><a href="#行内元素和块级元素" class="headerlink" title="行内元素和块级元素"></a>行内元素和块级元素</h3><p>行内元素:<code>padding</code>在四个方向都是有效果的。<code>margin</code>中<code>margin-left</code>,<code>margin-right</code>有效果，其他无效。<code>width</code>和<code>height</code>都有无效，但<code>line-height</code>有效。<br>可以自己测试下。(发现网上有些博客说<code>padding-bottom</code>无效,不知道是怎么来的，如果你在自己的浏览器环境下测试得出不一样的结论欢迎补充！)</p>
<p>默认情况下，块级元素会新起一行。<br>块级元素定义：当元素的 CSS 属性  display 为 block, list-item 或 table 时，它是块级元素 block-level 。块级元素（比如</p><p>)视觉上呈现为块，竖直排列。</p>
<p>块级盒(块格式化上下文 block formatting context)：每个块级元素至少生成一个块级盒，称为主要块级盒(principal block-level box)。一些元素，比如<code>&lt;li&gt;</code>，生成额外的盒来放置项目符号，不过多数元素只生成一个主要块级盒。 主要块级盒将包含后代元素生成的盒以及生成的内容。</p>
<p>这块还需要再仔细研究下。<a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Visual_formatting_model#.E8.A1.8C.E5.86.85.E7.BA.A7.E5.85.83.E7.B4.A0.E4.B8.8E.E8.A1.8C.E5.86.85.E7.9B.92(Inline-level_elements_and_inline_boxes" target="_blank" rel="external">MDN</a>)</p>
<p>一般情况下，行内元素只能包含数据和其他行内元素。<br>而块级元素可以包含行内元素和其他块级元素。这种结构上的包含继承区别可以使块级元素创建比行内元素更”大型“的结构。</p>
<h3 id="IEhack"><a href="#IEhack" class="headerlink" title="IEhack"></a>IEhack</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">.ie6_7_8&#123;</div><div class="line">    color:blue; /*所有浏览器*/</div><div class="line">    color:red\9; /*IE8以及以下版本浏览器*/</div><div class="line">    *color:green; /*IE7及其以下版本浏览器*/</div><div class="line">    _color:purple; /*IE6浏览器*/</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>!important</code>的IE hack手段</p>
<blockquote>
<p>网上很多资料中常常把!important也作为一个hack手段，其实这是一个误区。!important常常被我们用来更改样式，而不是兼容hack。造成这个误区的原因是IE6在某些情况下不主动识别!important,以至于常常被人误用做识别IE6的hack。可是，大家注意一下，IE6只是在某些情况下不识别（ie6下，同一个大括号里对同一个样式属性定义，其中一个加important 则important标记是被忽略的，例：{background:red!important; background:green;} ie6下解释为背景色green，其它浏览器解释为背景色red；如果这同一个样式在不同大括号里定义，其中一个加important 则important发挥正常作用，例：div{background:red!important} div{background:green}，这时所有浏览器统一解释为背景色red。）<br><a href="http://www.duitang.com/static/csshack.html" target="_blank" rel="external">参考地址</a></p>
</blockquote>
<h2 id="JS部分"><a href="#JS部分" class="headerlink" title="JS部分"></a>JS部分</h2><h3 id="typeof类型判断"><a href="#typeof类型判断" class="headerlink" title="typeof类型判断"></a>typeof类型判断</h3><ul>
<li>“undefined”(随便给一个变量)</li>
<li>“object” (包括typeof Null)</li>
<li>“string”</li>
<li>“function”(比如alert)</li>
<li>“number”</li>
<li>“boolean”</li>
<li>“symbol”(ES6新增)<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typeof</span> /s/ === <span class="string">'function'</span>; <span class="comment">// Chrome 1-12 , 不符合 ECMAScript 5.1</span></div><div class="line"><span class="keyword">typeof</span> /s/ === <span class="string">'object'</span>; <span class="comment">// Firefox 5+ , 符合 ECMAScript 5.1</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>遇到的题：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typeof</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="string">"a"</span>][<span class="number">1</span>,<span class="number">2</span>];</div></pre></td></tr></table></figure></p>
<p>嗯，猜猜这是什么类型？<br>这题其实考的其实是逗号表达式，后面<code>[1,2]</code>取的是2,所以数组里第2个就是<code>&quot;a&quot;</code>(“string”类型),当时以为是object，好伤感。</p>
<h3 id="跨域方法"><a href="#跨域方法" class="headerlink" title="跨域方法"></a>跨域方法</h3><p>同源策略：同协议，域名，端口。</p>
<h4 id="document-domain-iframe"><a href="#document-domain-iframe" class="headerlink" title="document.domain + iframe"></a>document.domain + iframe</h4><p><em>注意：仅在相同主域下才有效</em><br>不同的框架之间是可以获取<code>window</code>对象的，但却无法获取相应的属性和方法。比如，有一个页面，它的地址是<code>http://www.example.com/a.html</code> ， 在这个页面里面有一个<code>iframe</code>，它的src是<code>http://example.com/b.html</code>, 很显然，这个页面与它里面的<code>iframe</code>框架是不同域的，所以我们是无法通过在页面中书写js代码来获取<code>iframe</code>中的东西的<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> iframe = <span class="built_in">document</span>.getElementById(<span class="string">'iframe'</span>);</div><div class="line">        <span class="keyword">var</span> win = <span class="built_in">document</span>.contentWindow;<span class="comment">//可以获取到iframe里的window对象，但该window对象的属性和方法几乎是不可用的</span></div><div class="line">        <span class="keyword">var</span> doc = win.document;<span class="comment">//这里获取不到iframe里的document对象</span></div><div class="line">        <span class="keyword">var</span> name = win.name;<span class="comment">//这里同样获取不到window对象的name属性</span></div><div class="line">    &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span> = <span class="string">"iframe"</span> <span class="attr">src</span>=<span class="string">"http://example.com/b.html"</span> <span class="attr">onload</span> = <span class="string">"test()"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><code>document.domain</code>就可以派上用场了，我们只要把<code>http://www.example.com/a.html</code> 和 <code>http://example.com/b.html</code>这两个页面的<code>document.domain</code>都设成相同的域名就可以了。但要注意的是，<code>document.domain</code>的设置是有限制的，我们只能把<code>document.domain</code>设置成自身或更高一级的父域，且主域必须相同。</p>
<ol>
<li>在页面 <code>http://www.example.com/a.html</code>中设置<code>document.domain</code>:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;iframe id = &quot;iframe&quot; src=&quot;http://example.com/b.html&quot; onload = &quot;test()&quot;&gt;&lt;/iframe&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">    document.domain = &apos;example.com&apos;;//设置成主域</div><div class="line">    function test()&#123;</div><div class="line">        alert(document.getElementById(&apos;iframe&apos;).contentWindow);//contentWindow 可取得子窗口的 window 对象</div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<ol>
<li>在页面 <code>http://example.com/b.html</code> 中也设置<code>document.domain</code><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">document</span>.domain = <span class="string">'example.com'</span>;<span class="comment">//在iframe载入这个页面也设置document.domain，使之与主页面的document.domain相同</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="通过HTML5的postMessage方法跨域"><a href="#通过HTML5的postMessage方法跨域" class="headerlink" title="通过HTML5的postMessage方法跨域"></a>通过HTML5的postMessage方法跨域</h4><p>IE10+支持。<br>A页面通过postMessage方法发送消息<br><code>a.com/index.html</code>中的代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">"ifr"</span> <span class="attr">src</span>=<span class="string">"b.com/index.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> ifr = <span class="built_in">document</span>.getElementById(<span class="string">'ifr'</span>);</div><div class="line">    <span class="keyword">var</span> targetOrigin = <span class="string">'http://b.com'</span>;  <span class="comment">// 若写成'http://b.com/c/proxy.html'效果一样</span></div><div class="line">                                        <span class="comment">// 若写成'http://c.com'就不会执行postMessage了</span></div><div class="line">    ifr.contentWindow.postMessage(<span class="string">'I was there!'</span>, targetOrigin);</div><div class="line">&#125;;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>B页面通过message事件监听并接受消息<br><code>b.com/index.html</code>中的代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">        <span class="comment">// 通过origin属性判断消息来源地址</span></div><div class="line">        <span class="keyword">if</span> (event.origin == <span class="string">'http://a.com'</span>) &#123;</div><div class="line">            alert(event.data);    <span class="comment">// 弹出"I was there!"</span></div><div class="line">            alert(event.source);  <span class="comment">// 对a.com、index.html中window对象的引用</span></div><div class="line">                                  <span class="comment">// 但由于同源策略，这里event.source不可以访问window对象</span></div><div class="line">        &#125;</div><div class="line">    &#125;, <span class="literal">false</span>);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h4><p>CORS背后的思想，就是使用自定义的HTTP头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功，还是应该失败。<br>IE中对CORS的实现是xdr<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createCORS</span>(<span class="params">method, url</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">    <span class="keyword">if</span>(<span class="string">'withCredentials'</span> <span class="keyword">in</span> xhr)&#123;</div><div class="line">        xhr.open(method, url, <span class="literal">true</span>);</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> XDomainRequest != <span class="string">'undefined'</span>)&#123;</div><div class="line">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> XDomainRequest();</div><div class="line">        xhr.open(method, url);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        xhr = <span class="literal">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> xhr;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> request = createCORS(<span class="string">'get'</span>, <span class="string">'http://www.baidu.com'</span>);</div><div class="line"><span class="keyword">if</span>(request)&#123;</div><div class="line">    request.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        ......</div><div class="line">    &#125;;</div><div class="line">    request.send();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="jsonp跨域"><a href="#jsonp跨域" class="headerlink" title="jsonp跨域"></a>jsonp跨域</h4><p>因为通过script标签引入的js是不受同源策略的限制的。所以我们可以通过script标签引入一个js或者是一个其他后缀形式（如php，jsp等）的文件，此文件返回一个js函数的调用。<br>比如，有个a.html页面，它里面的代码需要利用ajax获取一个不同域上的json数据，假设这个json数据地址是<code>http://damonare.cn/data.php</code>, 那么<code>a.html</code>中的代码就可以这样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dosomething</span>(<span class="params">jsondata</span>)</span>&#123;</div><div class="line">        <span class="comment">//处理获得的json数据</span></div><div class="line">    &#125;</div><div class="line">&lt;\/script&gt;</div><div class="line"><span class="comment">//因为是markdown写的，所以页面显示内容可能有部分差异</span></div><div class="line">&lt;script src=\<span class="string">"http://example.com/data.php?callback=dosomething"</span>&gt;<span class="xml"><span class="tag">&lt;<span class="name">\</span>/<span class="attr">script</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>我们看到获取数据的地址后面还有一个callback参数，按惯例是用这个参数名，但是你用其他的也一样。当然如果获取数据的jsonp地址页面不是你自己能控制的，就得按照提供数据的那一方的规定格式来操作了。</p>
<p>因为是当做一个js文件来引入的，所以<a href="http://damonare.cn/data.php" target="_blank" rel="external">http://damonare.cn/data.php</a> 返回的必须是一个能执行的js文件，所以这个页面的php代码可能是这样的(一定要和后端约定好哦):<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$callback = $_GET[<span class="string">'callback'</span>];<span class="comment">//得到回调函数名</span></div><div class="line">$data = <span class="keyword">array</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>);<span class="comment">//要返回的数据</span></div><div class="line"><span class="keyword">echo</span> $callback.<span class="string">'('</span>.json_encode($data).<span class="string">')'</span>;<span class="comment">//输出</span></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>最终输出结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dosomething([&apos;a&apos;,&apos;b&apos;,&apos;c&apos;]);</div></pre></td></tr></table></figure></p>
<h5 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h5><ul>
<li>它不像XMLHttpRequest对象实现的Ajax请求那样受到同源策略的限制；它的兼容性更好，在更加古老的浏览器中都可以运行，不需要XMLHttpRequest或ActiveX的支持；并且在请求完毕后可以通过调用callback的方式回传结果。</li>
<li>它只支持GET请求而不支持POST等其它类型的HTTP请求；它只支持跨域HTTP请求这种情况，不能解决不同域的两个页面之间如何进行JavaScript调用的问题。</li>
</ul>
<h3 id="获取URL参数转换为对象"><a href="#获取URL参数转换为对象" class="headerlink" title="获取URL参数转换为对象"></a>获取URL参数转换为对象</h3><p>这里是《JavaScript高级程序设计三》里的原函数，注意使用的是 <code>location.search</code>返回的字符串是以<code>?</code>开头的,所以这里还需要加一个<code>substring(1)</code>表示从<code>?</code>之后取字符串<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getQueryStringArgs</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> qs = (location.search.length &gt; <span class="number">0</span> ? location.search.substring(<span class="number">1</span>) : <span class="string">""</span>),</div><div class="line">        args = &#123;&#125;,</div><div class="line">    items = qs.length ? qs.split(<span class="string">'&amp;'</span>) : [], </div><div class="line">    item = <span class="literal">null</span>,</div><div class="line">    name =  <span class="literal">null</span>,</div><div class="line">    valu = <span class="literal">null</span>,</div><div class="line">    i = <span class="number">0</span>,</div><div class="line">    len = items.length;</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; len; i++)&#123;</div><div class="line">        item = items[i].split(<span class="string">"="</span>);</div><div class="line">        name = <span class="built_in">decodeURIComponent</span>(item[<span class="number">0</span>]);</div><div class="line">        value = <span class="built_in">decodeURIComponent</span>(item[<span class="number">1</span>]);</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(name.length)&#123;</div><div class="line">            args[name] = value;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> args;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然，为了演示方便，我们可以直接传一个url参数到里面再做解析。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseQueryString</span>(<span class="params">url</span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> obj=&#123;&#125;;</div><div class="line">        <span class="keyword">var</span> keyvalue=[];</div><div class="line">        <span class="keyword">var</span> key=<span class="literal">null</span>,value=<span class="literal">null</span>;       </div><div class="line">        <span class="keyword">var</span> paraString=url.substring(url.lastIndexOf(<span class="string">"?"</span>)+<span class="number">1</span>,url.length).split(<span class="string">"&amp;"</span>);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> paraString)</div><div class="line">        &#123;</div><div class="line">            keyvalue = paraString[i].split(<span class="string">"="</span>);</div><div class="line">            key = <span class="built_in">decodeURIComponent</span>(keyvalue[<span class="number">0</span>]);</div><div class="line">            value = <span class="built_in">decodeURIComponent</span>(keyvalue[<span class="number">1</span>]);</div><div class="line">            obj[key]=value;            </div><div class="line">        &#125;        </div><div class="line">        <span class="keyword">return</span> obj;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> w3w = <span class="string">"http://blog.sina.com.cn/s/blog_5082f7b901015r2r.html?key1=1&amp;value=2"</span>;</div><div class="line"><span class="built_in">console</span>.log(parseQueryString(w3w));</div></pre></td></tr></table></figure></p>
<p>其实流程和上面的一样。<br><code>split()</code> 方法通过把字符串分割成子字符串来把一个 String 对象分割成一个字符串数组。<br><code>substring()</code> 返回字符串两个索引之间（或到字符串末尾）的子串。</p>
<ol>
<li>取出<code>?</code>之后的查询字符串参数</li>
<li>以<code>&amp;</code>为分割符划分为不同的字符串数组</li>
<li>再以<code>=</code>为分割符划分<code>key</code>和<code>value</code></li>
<li>保存到新的对象中<h3 id="随机排序"><a href="#随机排序" class="headerlink" title="随机排序"></a>随机排序</h3>写一段代码，随机排序array([1,2,3,4,5,6,7,8,9])。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">//我自己写的</div><div class="line">function array(arr)&#123;</div><div class="line">    var N = arr.length;</div><div class="line">    var newArr = [];</div><div class="line">    for(var i = 0; i &lt; N; i++)&#123;</div><div class="line">        if(Math.random() &gt; 0.5)&#123;</div><div class="line">            newArr.push(arr[i]);</div><div class="line">        &#125;else&#123;</div><div class="line">            newArr.unshift(arr[i]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return newArr;</div><div class="line">&#125;</div><div class="line">//利用Math.random随机判断插入顺序</div><div class="line"></div><div class="line">//再看看大师的作品(洗牌算法)</div><div class="line">function knuth(arr)&#123;</div><div class="line">    var N = arr.length;</div><div class="line">    for(var i = 0; i &lt; N; i++)&#123;</div><div class="line">        //保证每个数都能与后面一个数字进行交换</div><div class="line">        var r = i + Math.floor(Math.random()*(N - i));</div><div class="line">        var temp = arr[r];</div><div class="line">        arr[r] = arr[i];</div><div class="line">        arr[i] = temp;</div><div class="line">        console.log(&quot;r现在是 &quot; + r);</div><div class="line">    &#125;</div><div class="line">    return arr;</div><div class="line">&#125;</div><div class="line">//还可以这样</div><div class="line">str.sort(function()&#123;</div><div class="line">    return (0.5 - Math.random());</div><div class="line">&#125;);</div><div class="line"></div><div class="line">//ES6</div><div class="line">function shuffle(arr)&#123;</div><div class="line">    let n = arr.length,random;</div><div class="line">    while(0!=n)&#123;</div><div class="line">        random = (Math.random()*n--) &gt;&gt;&gt; 0; //无符号右移运算符向下取整</div><div class="line">        [arr[n], arr[random]] = [arr[random], arr[n]];</div><div class="line">    &#125;</div><div class="line">    return arr;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="实现Drag功能"><a href="#实现Drag功能" class="headerlink" title="实现Drag功能"></a>实现Drag功能</h3><p>HTML5自带拖拽，但这里主要用原生JS去实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html lang=&quot;en&quot;&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line">    &lt;title&gt;Document&lt;/title&gt;</div><div class="line">    &lt;style&gt;</div><div class="line">        div,body&#123;</div><div class="line">            padding: 0;</div><div class="line">            margin: 0;</div><div class="line">        &#125;</div><div class="line">        #drag&#123;</div><div class="line">            width: 100px;</div><div class="line">            height: 100px;</div><div class="line">            background: red;</div><div class="line">            position: absolute;</div><div class="line">        &#125;</div><div class="line">    &lt;/style&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">    &lt;div id=&quot;drag&quot;&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line"></div><div class="line">    &lt;script&gt;</div><div class="line">        window.onload = function()&#123;</div><div class="line">            drag.onmousedown = function(event)&#123;</div><div class="line">                </div><div class="line">                event = window.event || event;</div><div class="line">                var drag = document.querySelector(&apos;#drag&apos;);</div><div class="line">                var disX = event.clientX - drag.offsetLeft;</div><div class="line">                var disY = event.clientY - drag.offsetTop;</div><div class="line"></div><div class="line">                drag.onmousemove = function(event)&#123;</div><div class="line">                    event = window.event || event;</div><div class="line">                    drag.style.left = event.clientX - disX + &quot;px&quot;;</div><div class="line">                    drag.style.top = event.clientY - disY + &quot;px&quot;;</div><div class="line">                &#125;</div><div class="line">                drag.onmouseup = function(evebt)&#123;</div><div class="line">                    drag.onmouseup = null;</div><div class="line">                    drag.onmousemove = null;</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">        &#125;</div><div class="line">    &lt;/script&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>这么写太low了。要参考高程的逼格去写啊。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;div id="drag" class="draggable"&gt;</div><div class="line">    &lt;/div&gt;</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Drag = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> dragging = <span class="literal">null</span>,</div><div class="line">                disX = <span class="number">0</span>,</div><div class="line">                disY = <span class="number">0</span>;</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handlerEvent</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">                event = <span class="built_in">window</span>.event || event;</div><div class="line">                <span class="keyword">var</span> target = event.target || event.srcElement;</div><div class="line"></div><div class="line">                <span class="keyword">switch</span>(event.type)&#123;</div><div class="line">                    <span class="keyword">case</span> <span class="string">"mousedown"</span>: </div><div class="line">                        <span class="keyword">if</span>(target.className.indexOf(<span class="string">"draggable"</span>) &gt; <span class="number">-1</span>)&#123;</div><div class="line">                            dragging = target;</div><div class="line">                            disX = event.clientX - target.offsetLeft;</div><div class="line">                            disY = event.clientY - target.offsetTop;</div><div class="line">                        &#125;;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> <span class="string">"mousemove"</span>:</div><div class="line">                        <span class="keyword">if</span>(dragging !== <span class="literal">null</span>)&#123;</div><div class="line">                            dragging.style.left = event.clientX - disX + <span class="string">"px"</span>;</div><div class="line">                            dragging.style.top = event.clientY - disY + <span class="string">"px"</span>;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> <span class="string">"mouseup"</span>:</div><div class="line">                        dragging = <span class="literal">null</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                &#125;   </div><div class="line">            &#125;;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                enable: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                    <span class="built_in">document</span>.addEventListener(<span class="string">"mousedown"</span>,handlerEvent, <span class="literal">false</span>);</div><div class="line">                    <span class="built_in">document</span>.addEventListener(<span class="string">"mousemove"</span>,handlerEvent, <span class="literal">false</span>);</div><div class="line">                    <span class="built_in">document</span>.addEventListener(<span class="string">"mouseup"</span>,handlerEvent, <span class="literal">false</span>);   </div><div class="line">                &#125;,</div><div class="line">                disable: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                    <span class="built_in">document</span>.removeEventListener(<span class="string">"mousedown"</span>,handlerEvent, <span class="literal">false</span>);</div><div class="line">                    <span class="built_in">document</span>.removeEventListener(<span class="string">"mousemove"</span>,handlerEvent, <span class="literal">false</span>);</div><div class="line">                    <span class="built_in">document</span>.removeEventListener(<span class="string">"mouseup"</span>,handlerEvent, <span class="literal">false</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">        &#125;();</div><div class="line">        Drag.enable();</div></pre></td></tr></table></figure>
<h3 id="运动框架"><a href="#运动框架" class="headerlink" title="运动框架"></a>运动框架</h3><p>这道题主要是对一个物体进行移动，并且实现透明度相应的变化。<br>从x=100,y=100移动到x=10,y=10，移动过程中实现透明度等于x值。<br>最好是能封装一个比较通用的函数。手写代码还真是感觉不一样，说明自己掌握的还是很薄弱。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;div id=&quot;dialog&quot; class=&quot;box&quot;&gt;&lt;/div&gt;</div><div class="line">&lt;button class=&apos;jclick&apos;&gt;啦啦啦&lt;/button&gt;</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这段函数获取样式表和行内样式</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getStyle</span>(<span class="params">obj, attr</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(obj.currentStyle)&#123;</div><div class="line">        <span class="keyword">return</span> obj.currentStyle[attr];</div><div class="line">    &#125;<span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> getComputedStyle(obj,<span class="literal">false</span>)[attr];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">startMove</span>(<span class="params">obj, json, fn</span>)</span>&#123;</div><div class="line">    clearInterval(obj.timer);</div><div class="line">    obj.timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> bStop = <span class="literal">true</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> attr <span class="keyword">in</span> json)&#123;</div><div class="line">            <span class="keyword">var</span> iCur = <span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span>(attr === <span class="string">'opacity'</span>)&#123;</div><div class="line">                iCur = <span class="built_in">parseInt</span>(<span class="built_in">parseFloat</span>(getStyle(obj,attr))*<span class="number">100</span>);</div><div class="line">            &#125;<span class="keyword">else</span> &#123;</div><div class="line">                iCur = <span class="built_in">parseInt</span>(getStyle(obj, attr));</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">var</span> iSpeed = (json[attr] - iCur)/<span class="number">8</span>;</div><div class="line">            iSpeed = iSpeed &gt; <span class="number">0</span> ? <span class="built_in">Math</span>.ceil(iSpeed): <span class="built_in">Math</span>.floor(iSpeed);</div><div class="line"></div><div class="line">            <span class="keyword">if</span>(iCur != json[attr])&#123;</div><div class="line">                bStop = <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(attr == <span class="string">'opacity'</span>)&#123;</div><div class="line">                obj.style.filter = <span class="string">'alpha(opacity:'</span> + (iCur+iSpeed)+<span class="string">')'</span>;</div><div class="line">                obj.style.opacity = (iCur + iSpeed)/ <span class="number">100</span>;</div><div class="line">            &#125;<span class="keyword">else</span> &#123;</div><div class="line">                obj.style[attr] = iCur + iSpeed + <span class="string">"px"</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(bStop)&#123;</div><div class="line">            clearInterval(obj.timer);</div><div class="line">            <span class="keyword">if</span>(fn)&#123;</div><div class="line">                fn();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;,<span class="number">30</span>)</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> dialog = <span class="built_in">document</span>.getElementById(<span class="string">"dialog"</span>);</div><div class="line"><span class="keyword">var</span> jclick = <span class="built_in">document</span>.querySelector(<span class="string">".jclick"</span>);</div><div class="line"><span class="comment">//这段函数严重的问题，地狱回调啊</span></div><div class="line">jclick.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        startMove(dialog, &#123;left:<span class="number">10</span>,top:<span class="number">10</span>,opacity:<span class="number">10</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            startMove(dialog, &#123;left:<span class="number">100</span>,top:<span class="number">100</span>,opacity:<span class="number">100</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                startMove(dialog, &#123;left:<span class="number">1220</span>,top:<span class="number">100</span>,opacity:<span class="number">100</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                    startMove(dialog, &#123;left:<span class="number">120</span>,top:<span class="number">100</span>,opacity:<span class="number">10</span>&#125;);</div><div class="line">                &#125;)</div><div class="line">            &#125;);</div><div class="line">        &#125;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>所以还是得改改代码。说实话，面向对象虽然我都理解，但就是写不出，不知道是咋回事，所以也是参考了别人写的代码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">var Animate = function(oElement, options, callback)&#123;this.init.apply(this, arguments)&#125;;</div><div class="line">    Animate.prototype = &#123;</div><div class="line">        init: function(oElement, options, callback)&#123;</div><div class="line">            var oThis = this;</div><div class="line">            this.options = options;</div><div class="line">            this.callback = callback;</div><div class="line">            this.oElement = typeof oElement === &apos;string&apos;?document.getElementById(oElement) : oElement;</div><div class="line">            clearInterval(this.timer);</div><div class="line">            this.timer = setInterval(function()&#123;</div><div class="line">                oThis.doMove();</div><div class="line">            &#125;, 30)</div><div class="line">        &#125;,</div><div class="line">        css: function(attr, value)&#123;</div><div class="line">            if(arguments.length == 1)&#123;</div><div class="line">                return parseFloat(this.oElement.currentStyle? this.oElement.currentStyle[attr]: getComputedStyle(this.oElement, null)[attr]);</div><div class="line">            &#125;else if(arguments.length === 2)&#123;</div><div class="line">                attr === &apos;opacity&apos; ? (this.oElement.style.filter ==  &apos;alpha(opacity=&apos; + value +&apos;)&apos;,this.oElement.style.opacity =value/100) : this.oElement.style[attr] = value + &quot;px&quot;;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        doMove: function()&#123;</div><div class="line">            var opt = this.options;</div><div class="line">            var bComplete = true;</div><div class="line">            for(var p in opt)&#123;</div><div class="line">                var iCur = p === &apos;opacity&apos; ? parseInt(this.css(p).toFixed(2) * 100) : this.css(p);</div><div class="line">                var iSpeed = (opt[p] - iCur) / 8;</div><div class="line">                iSpeed = iSpeed &gt; 0 ? Math.ceil(iSpeed) : Math.floor(iSpeed);</div><div class="line">                opt[p] == iCur || (bComplete = false, this.css(p, iCur + iSpeed));</div><div class="line">            &#125;</div><div class="line">            bComplete &amp;&amp; (clearInterval(this.timer), this.callback &amp;&amp; this.callback.call(this))</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    window.onload = function()&#123;</div><div class="line">        var dialog = document.getElementById(&quot;dialog&quot;);</div><div class="line">        var jclick = document.querySelector(&quot;.jclick&quot;);</div><div class="line">        var aData = [</div><div class="line">            &#123;left:10,opacity:10&#125;,</div><div class="line">            &#123;left:1000,opacity:100,top:10&#125;,</div><div class="line">        ];</div><div class="line">        jclick.onclick = function()&#123;</div><div class="line"></div><div class="line">            var i = -1;</div><div class="line">            function begin()&#123;</div><div class="line">                i&lt; aData.length ?　i++ : i--;</div><div class="line">                var obj = new Animate(dialog, aData[i], begin);</div><div class="line">                if(i == aData.length || i &lt; 0) &#123;</div><div class="line">                    clearInterval(obj.timer);</div><div class="line">                    return;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            begin();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h3 id="正则表达式-1"><a href="#正则表达式-1" class="headerlink" title="正则表达式"></a>正则表达式</h3><p>写一个正则匹配表达式匹配包含数字和字母且在8-16位。其实就是匹配密码的合法输入。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]&#123;8,16&#125;/</span>;</div></pre></td></tr></table></figure></p>
<p>这段正则的含义：<br>^ 匹配开头<br>$ 匹配到结尾<br>[0-9a-zA-Z] 匹配0-9,a-z,A-Z中任意字符<br>{8, 16} 至少8位，至多16位</p>
<ul>
<li>至少出现一次<br>(?!…) 负向零宽断言(真难理解)，否定顺序环视，也就是说右边必须在[0-9]后必须出现非[0-9]的结构</li>
</ul>
<p>上面判断的条件拆分为</p>
<ol>
<li>必须为数字和字母</li>
<li>不能全是数字 (第一个负向零宽断言)</li>
<li>不能全是字母 (第二个负向零宽断言)</li>
</ol>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>通过这次笔试，发现自己在基础的JS代码上还是不够熟练，特别是写段代码的时候。想要写出一手健壮的JS代码还是很难的。<br>通过这次笔试还需要</p>
<ul>
<li>把MDN的JavaScript面向对象再过一遍</li>
<li>再看看设计模式，据说JavaScript设计模式与开发实践不错</li>
<li>从小demo入手，用面向对象改写。</li>
<li>《JavaScript高级程序设计三》确实是好书。面试题都是现成的！是该好好看下，Ajax这块尤为重要</li>
<li>webkit技术内幕</li>
</ul>
<p>错过了秋招，除了这次笔试题之外，也了解到一些加分项：</p>
<ul>
<li>Node.js</li>
<li><code>MV*</code>框架</li>
</ul>
<p>要学的太多了，加油吧，小伙子。机会很多，可需要能力才能驾驭机遇。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/06/基于MVC的JavaScript-Web富应用开发/" itemprop="url">
                  基于MVC的JavaScript Web富应用开发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-06T17:21:19+08:00" content="2016-11-06">
              2016-11-06
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/06/基于MVC的JavaScript-Web富应用开发/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/06/基于MVC的JavaScript-Web富应用开发/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>不看书就觉得自己学得不充实。只是希望自己在看书摘录笔记的时候别忘了留点时间思考。</em></p>
<h2 id="MVC和类"><a href="#MVC和类" class="headerlink" title="MVC和类"></a>MVC和类</h2><ul>
<li>数据(模型)</li>
<li>展现层(视图)</li>
<li>控制层(控制器)</li>
</ul>
<ol>
<li>用户与应用产生交互</li>
<li>控制器的事件处理器被触发</li>
<li>控制器从模型中请求数据，并将其交给视图</li>
<li>视图将数据呈现给用户</li>
</ol>
<h3 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h3><p>存放引用的所有数据对象，模型只需包含数据及其直接和这些数据关联的逻辑。任何事件处理代码、视图模板以及和模型无关的逻辑都应该被隔离在模型外。</p>
<p>它控制器从服务器中抓取数据或创建新的记录时，它就将数据包装成模型实例。</p>
<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p>视图层是呈现给用户。</p>
<h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h3><p>控制器从视图中获得事件和输入，对它们进行处理并更新视图。当页面加载时，控制器会给视图添加事件监听，</p>
<h2 id="向模块化进军"><a href="#向模块化进军" class="headerlink" title="向模块化进军"></a>向模块化进军</h2><h3 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> clicky =&#123;</div><div class="line">    wasClicked: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">//...</span></div><div class="line">    &#125;,</div><div class="line">    addListeners: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">        $(<span class="string">'clicky'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            self.wasClicked();</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">clicky.addListeners();</div></pre></td></tr></table></figure>
<p>利用apply<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> proxy = <span class="function"><span class="keyword">function</span>(<span class="params">func, thisObject</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> func.apply(thisObject, <span class="built_in">arguments</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> clicky =&#123;</div><div class="line">    wasClicked: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">//...</span></div><div class="line">    &#125;,</div><div class="line">    addListeners: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        $(<span class="string">'clicky'</span>).click(proxy(<span class="keyword">this</span>.wasClicked, <span class="keyword">this</span>));</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>jQuery实现了该机制<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">".clicky"</span>).click($&gt;proxy(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">/*...*/</span>&#125;, <span class="keyword">this</span>));</div></pre></td></tr></table></figure></p>
<h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><h3 id="事件库"><a href="#事件库" class="headerlink" title="事件库"></a>事件库</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">jQuery(<span class="built_in">window</span>).bind(<span class="string">"load"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    $(<span class="string">"#demo"</span>).submit(checkform);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 在DOM加载完毕时触发这个事件，此时的图片和样式表可能还未加载完毕。</span></div><div class="line">jQuery(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>)</span>&#123;</div><div class="line">    $(<span class="string">"#demo"</span>).submit(checkform);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="事件委托"><a href="#事件委托" class="headerlink" title="事件委托"></a>事件委托</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">"ul"</span>).delegate(<span class="string">"li"</span>, <span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">/**/</span>&#125;)</div></pre></td></tr></table></figure>
<h3 id="自定义事件"><a href="#自定义事件" class="headerlink" title="自定义事件"></a>自定义事件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> PubSub = &#123;</div><div class="line">    subscribe: <span class="function"><span class="keyword">function</span>(<span class="params">ev, callback</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> calls = <span class="keyword">this</span>._callbacks || (<span class="keyword">this</span>._callbacks = &#123;&#125;);</div><div class="line">        (<span class="keyword">this</span>._callbacks[ev] || (<span class="keyword">this</span>._callbacks[ev] = [])).push(callback);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    publish: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">//转换为真正的数组</span></div><div class="line">        <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">0</span>);</div><div class="line">        <span class="comment">//取出第一个参数，事件名称</span></div><div class="line">        <span class="keyword">var</span> ev = args.shift();</div><div class="line"></div><div class="line">        <span class="keyword">var</span> list, calls, i, l;</div><div class="line">        <span class="keyword">if</span>(!(calls = <span class="keyword">this</span>._callbacks)) <span class="keyword">return</span>  <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">if</span>(!(lists = <span class="keyword">this</span>._callbacks[ev])) <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line"></div><div class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>, l = list.length; i &lt; l; i++)&#123;</div><div class="line">            list[i].apply(<span class="keyword">this</span>, args);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line">PubSub.subscribe(<span class="string">'ww'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"ww"</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">PubSub.publish(<span class="string">"ww"</span>); <span class="comment">// ww;</span></div></pre></td></tr></table></figure>
<h2 id="模型和数据"><a href="#模型和数据" class="headerlink" title="模型和数据"></a>模型和数据</h2><h3 id="原型继承"><a href="#原型继承" class="headerlink" title="原型继承"></a>原型继承</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="built_in">Object</span>.create !== <span class="string">'function'</span>)&#123;</div><div class="line">    <span class="built_in">Object</span>.create = <span class="function"><span class="keyword">function</span>(<span class="params">o</span>)</span>&#123;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">        F.prototype = o;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> F();</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="添加ORM属性"><a href="#添加ORM属性" class="headerlink" title="添加ORM属性"></a>添加ORM属性</h3><p>ORM(object-relational mapper)构建对象映射，用于实现面向对象编程语言里不同类型系统的数据之间的转换。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Model = &#123;</div><div class="line">    inherit: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</div><div class="line">    created: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</div><div class="line">    prototype: &#123;</div><div class="line">        init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">    &#125;,</div><div class="line">    create: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> object = <span class="built_in">Object</span>.create(<span class="keyword">this</span>);</div><div class="line">        object.parent = <span class="keyword">this</span>;</div><div class="line">        object.prototype = object.fn = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.prototype);</div><div class="line"></div><div class="line">        object.created();</div><div class="line">        <span class="keyword">this</span>.inherited(object);</div><div class="line">        <span class="keyword">return</span> object;</div><div class="line">    &#125;,</div><div class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> instance = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.prototype);</div><div class="line">        instance.parent = <span class="keyword">this</span>;</div><div class="line">        instance.init.apply(instance, <span class="built_in">arguments</span>);</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;,</div><div class="line">    extend: <span class="function"><span class="keyword">function</span>(<span class="params">o</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> extended = o.extended;</div><div class="line">        jQuery.extend(<span class="keyword">this</span>, o);</div><div class="line">        <span class="keyword">if</span>(extended) extended(<span class="keyword">this</span>);</div><div class="line">    &#125;,</div><div class="line">    include: <span class="function"><span class="keyword">function</span>(<span class="params">o</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> included = o.included;</div><div class="line">        jQuery.extend(<span class="keyword">this</span>.prototype, o);</div><div class="line">        <span class="keyword">if</span>(included) included(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="持久化记录"><a href="#持久化记录" class="headerlink" title="持久化记录"></a>持久化记录</h3><p>将引用保存至新创建的实例中以便任何时候都能访问它。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//用来保存资源的对象</span></div><div class="line">Model.records = &#123;&#125;;</div><div class="line"></div><div class="line">Model.include(&#123;</div><div class="line">    newRecord: <span class="literal">true</span>,</div><div class="line"></div><div class="line">    create: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.newRecord = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">this</span>.parent.records[<span class="keyword">this</span>.id] = <span class="keyword">this</span>;</div><div class="line">    &#125;,</div><div class="line">    destory: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">delete</span> <span class="keyword">this</span>.parent.records[<span class="keyword">this</span>.id];</div><div class="line">    &#125;,</div><div class="line">    update: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.parent.records[<span class="keyword">this</span>.id] = <span class="keyword">this</span>;<span class="comment">//更新对象引用</span></div><div class="line">    &#125;,</div><div class="line">    save: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">//将对象存入hash记录中，保持一个引用指向它</span></div><div class="line">        <span class="keyword">this</span>.newRecord? <span class="keyword">this</span>.create() : <span class="keyword">this</span>.update();</div><div class="line">    &#125;,</div><div class="line">    find: <span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.records[id] || <span class="built_in">Error</span>(<span class="string">"Unknown record"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/06/阅读一起学Node/" itemprop="url">
                  阅读一起学Node
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-06T10:14:57+08:00" content="2016-11-06">
              2016-11-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Node/" itemprop="url" rel="index">
                    <span itemprop="name">Node</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/06/阅读一起学Node/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/06/阅读一起学Node/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Node-js环境搭建"><a href="#Node-js环境搭建" class="headerlink" title="Node.js环境搭建"></a>Node.js环境搭建</h2><h3 id="安装-Node-js"><a href="#安装-Node-js" class="headerlink" title="安装 Node.js"></a>安装 Node.js</h3><blockquote>
<p>小提示：从 <a href="http://node.green" target="_blank" rel="external">http://node.green</a> 上可以看到 Node.js 各个版本对 ES6 的支持情况。</p>
</blockquote>
<h4 id="n-和-nvm"><a href="#n-和-nvm" class="headerlink" title="n 和 nvm"></a>n 和 nvm</h4><p>通常我们使用稳定的 LTS 版本的 Node.js 即可，但有的情况下我们又想尝试一下新的特性，我们总不能来回安装不同版本的 Node.js 吧，这个时候我们就需要 n 或者 nvm 了。</p>
<p>nvm:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.29.0/install.sh | bash</div></pre></td></tr></table></figure></p>
<p>切换版本时，曾经在全局安装的各种 node 模块们全都需要重新安装，因为全局模块被安装在每个 node 版本自己的沙箱中，因此它们和老版本的 node 一起被埋葬了。</p>
<ul>
<li>nvm 不支持 Windows。</li>
</ul>
<p>n:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g n</div></pre></td></tr></table></figure></p>
<p>在安装的时候，n 会先将指定版本的 node 存储下来，然后将其复制到我们熟知的路径 /usr/local/bin，非常简单明了。</p>
<h4 id="nrm"><a href="#nrm" class="headerlink" title="nrm"></a>nrm</h4><p>nrm 是一个管理 npm 源的工具。<br>通常我们会把 gem 源切到国内的淘宝镜像，这样在安装和更新一些包的时候比较快。nrm 同理，用来切换官方 npm 源和国内的 npm 源<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//显示npm</div><div class="line">nrm ls</div><div class="line"></div><div class="line">//切换到cnpm,淘宝镜像，下载包会快些，如果安装过的话</div><div class="line">nrm use cnpm</div></pre></td></tr></table></figure></p>
<h3 id="MongoDB-的安装与使用"><a href="#MongoDB-的安装与使用" class="headerlink" title="MongoDB 的安装与使用"></a>MongoDB 的安装与使用</h3><h4 id="Robomongo-和-MongoChef"><a href="#Robomongo-和-MongoChef" class="headerlink" title="Robomongo 和 MongoChef"></a>Robomongo 和 MongoChef</h4><p>Robomongo 是一个基于 Shell 的跨平台开源 MongoDB 可视化管理工具，支持 Windows、Linux 和 Mac，嵌入了 JavaScript 引擎和 MongoDB mongo，只要你会使用 mongo shell，你就会使用 Robomongo，它还提了供语法高亮、自动补全、差别视图等。</p>
<blockquote>
<p>小提示: MongoChef 相较于 Robomongo 更强大一些，但 Robomongo 比较轻量也能满足大部分的常规需求。</p>
</blockquote>
<p>我安装了<code>Robomongo</code>，需要先创建一个js文件执行，alt+Enter 执行命令。（windows）</p>
<h2 id="Node知识点"><a href="#Node知识点" class="headerlink" title="Node知识点"></a>Node知识点</h2><h3 id="从require到AMD和CMD"><a href="#从require到AMD和CMD" class="headerlink" title="从require到AMD和CMD"></a>从require到AMD和CMD</h3><p>在node.js中，采用的是CommonJS的规范实现，通过全局方法require()引入模块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var a = require(&quot;http&quot;);</div></pre></td></tr></table></figure></p>
<p>这种一种同步机制，必须加载完模块后才能执行后面语句。因为是在服务器环境下运行，所以要加载的模块就是读取磁盘的速度，所以速度快到可以忽略不计。</p>
<p>但这种方式不使用浏览器，这主要是由于同步加载带来的弊端：</p>
<ul>
<li>必须依赖于加载完的模块后才能执行，加载时间长</li>
<li>当文件过大时出现客户端假死状态</li>
</ul>
<p>对于浏览器而言只能采用异步加载方式，即AMD(“Asynchronous Module Definition”)。<br>采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。</p>
<p>巧的是，AMD也采用require()语句加载模块。但它要求有两个参数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">require([module], callback);</div></pre></td></tr></table></figure></p>
<p>第一个参数[module]，是一个数组，里面的成员就是要加载的模块；第二个参数callback，则是加载成功之后的回调函数。如果将前面的代码改写成AMD形式，就是下面这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">require([&apos;math&apos;], function (math) &#123;</div><div class="line">　　　　math.add(2, 3);</div><div class="line">　　&#125;);</div></pre></td></tr></table></figure></p>
<p>主要有两个Javascript库实现了AMD规范：<code>require.js</code>和<code>curl.js</code>。</p>
<h3 id="require-js的用法"><a href="#require-js的用法" class="headerlink" title="require.js的用法"></a>require.js的用法</h3><p>require.js解决两个问题</p>
<ul>
<li>实现js文件的异步加载，避免网页失去响应；</li>
<li>管理模块之间的依赖性，便于代码的编写和维护。</li>
</ul>
<h4 id="require的加载"><a href="#require的加载" class="headerlink" title="require的加载"></a>require的加载</h4><p><a href="http://requirejs.org/docs/download.html" target="_blank" rel="external">官网</a>下载最新版本，将该代码放置于<code>body</code>底部<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　&lt;script src=&quot;js/require.js&quot;&gt;&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>然后加载自己的代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script src=&quot;js/require.js&quot; data-main=&quot;js/main&quot;&gt;&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p><code>data-main</code>属性的作用是，指定网页程序的主模块。在上例中，就是js目录下面的main.js，这个文件会第一个被require.js加载。由于require.js默认的文件后缀名是js，所以可以把main.js简写成main。</p>
<h4 id="主模块的写法"><a href="#主模块的写法" class="headerlink" title="主模块的写法"></a>主模块的写法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// main.js</span></div><div class="line">　　<span class="built_in">require</span>([<span class="string">'moduleA'</span>, <span class="string">'moduleB'</span>, <span class="string">'moduleC'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">moduleA, moduleB, moduleC</span>)</span>&#123;</div><div class="line">　　　　<span class="comment">// some code here</span></div><div class="line">　　&#125;);</div><div class="line"><span class="comment">//假如加载juqery,underscore,backbone3个模块</span></div><div class="line"><span class="built_in">require</span>([<span class="string">'jquery'</span>, <span class="string">'underscore'</span>, <span class="string">'backbone'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">$, _, Backbone</span>)</span>&#123;</div><div class="line">　　　　<span class="comment">// some code here</span></div><div class="line">　　&#125;);</div></pre></td></tr></table></figure>
<h4 id="模块的加载"><a href="#模块的加载" class="headerlink" title="模块的加载"></a>模块的加载</h4><p>主模块的依赖模块是[‘jquery’, ‘underscore’, ‘backbone’]。默认情况下，require.js假定这三个模块与main.js在同一个目录，文件名分别为jquery.js，underscore.js和backbone.js，然后自动加载。<br>使用require.config()方法，我们可以对模块的加载行为进行自定义。require.config()就写在主模块（main.js）的头部。参数就是一个对象，这个对象的paths属性指定各个模块的加载路径。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>.config(&#123;</div><div class="line">　　　　paths: &#123;</div><div class="line">　　　　　　<span class="string">"jquery"</span>: <span class="string">"jquery.min"</span>,</div><div class="line">　　　　　　<span class="string">"underscore"</span>: <span class="string">"underscore.min"</span>,</div><div class="line">　　　　　　<span class="string">"backbone"</span>: <span class="string">"backbone.min"</span></div><div class="line">　　　　&#125;</div><div class="line">　　&#125;);</div></pre></td></tr></table></figure>
<p>如果这些模块在其他目录，比如js/lib目录，则有两种写法。一种是逐一指定路径。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">　require.config(&#123;</div><div class="line">　　　　paths: &#123;</div><div class="line">　　　　　　&quot;jquery&quot;: &quot;lib/jquery.min&quot;,</div><div class="line">　　　　　　&quot;underscore&quot;: &quot;lib/underscore.min&quot;,</div><div class="line">　　　　　　&quot;backbone&quot;: &quot;lib/backbone.min&quot;</div><div class="line">　　　　&#125;</div><div class="line">　　&#125;);</div></pre></td></tr></table></figure></p>
<p>另一种则是直接改变基目录（baseUrl）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">require.config(&#123;</div><div class="line">　　　　baseUrl: &quot;js/lib&quot;,</div><div class="line">　　　　paths: &#123;</div><div class="line">            //假如jquery在另外一台主机上</div><div class="line">　　　　　　&quot;jquery&quot;: &quot;https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min&quot;,</div><div class="line">　　　　　　&quot;underscore&quot;: &quot;underscore.min&quot;,</div><div class="line">　　　　　　&quot;backbone&quot;: &quot;backbone.min&quot;</div><div class="line">　　　　&#125;</div><div class="line">　　&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="AMD模块的写法"><a href="#AMD模块的写法" class="headerlink" title="AMD模块的写法"></a>AMD模块的写法</h3><p>require.js加载的模块，采用AMD规范。也就是说，模块必须按照AMD的规定来写。<br>是模块必须采用特定的define()函数来定义。如果一个模块不依赖其他模块，那么可以直接定义在define()函数之中。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// math.js</span></div><div class="line">　　define(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</div><div class="line">　　　　<span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span> (<span class="params">x,y</span>)</span>&#123;</div><div class="line">　　　　　　<span class="keyword">return</span> x+y;</div><div class="line">　　　　&#125;;</div><div class="line">　　　　<span class="keyword">return</span> &#123;</div><div class="line">　　　　　　add: add</div><div class="line">　　　　&#125;;</div><div class="line">　　&#125;);</div><div class="line"></div><div class="line"><span class="comment">//-----加载方式</span></div><div class="line">　<span class="comment">// main.js</span></div><div class="line">　　<span class="built_in">require</span>([<span class="string">'math'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">math</span>)</span>&#123;</div><div class="line">　　　　alert(math.add(<span class="number">1</span>,<span class="number">1</span>));</div><div class="line">　　&#125;);</div></pre></td></tr></table></figure></p>
<p>如果这个模块还依赖其他模块，那么define()函数的第一个参数，必须是一个数组，指明该模块的依赖性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">　define([&apos;myLib&apos;], function(myLib)&#123;</div><div class="line">　　　　function foo()&#123;</div><div class="line">　　　　　　myLib.doSomething();</div><div class="line">　　　　&#125;</div><div class="line">　　　　return &#123;</div><div class="line">　　　　　　foo : foo</div><div class="line">　　　　&#125;;</div><div class="line">　　&#125;);</div></pre></td></tr></table></figure></p>
<p><a href="http://www.ruanyifeng.com/blog/2015/05/require.html" target="_blank" rel="external">require.js源码</a></p>
<h3 id="exports-和-module-exports"><a href="#exports-和-module-exports" class="headerlink" title="exports 和 module.exports"></a>exports 和 module.exports</h3><p>这个例子倒是很好，加深了我对引用赋值的理解<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = &#123;name: <span class="number">1</span>&#125;;</div><div class="line"><span class="keyword">var</span> b = a;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(a);</div><div class="line"><span class="built_in">console</span>.log(b);</div><div class="line"></div><div class="line">b.name = <span class="number">2</span>;</div><div class="line"><span class="built_in">console</span>.log(a);</div><div class="line"><span class="built_in">console</span>.log(b);</div><div class="line"></div><div class="line"><span class="keyword">var</span> b = &#123;name: <span class="number">3</span>&#125;;</div><div class="line"><span class="built_in">console</span>.log(a);</div><div class="line"><span class="built_in">console</span>.log(b);</div></pre></td></tr></table></figure></p>
<p>运行结果如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123; name: <span class="number">1</span> &#125;</div><div class="line">&#123; name: <span class="number">1</span> &#125;</div><div class="line">&#123; name: <span class="number">2</span> &#125;</div><div class="line">&#123; name: <span class="number">2</span> &#125;</div><div class="line">&#123; name: <span class="number">2</span> &#125;</div><div class="line">&#123; name: <span class="number">3</span> &#125;</div></pre></td></tr></table></figure></p>
<p>a 是一个对象，b 是对 a 的引用，即 a 和 b 指向同一块内存，所以前两个输出一样。当对 b 作修改时，即 a 和 b 指向同一块内存地址的内容发生了改变，所以 a 也会体现出来，所以第三四个输出一样。当 b 被覆盖时，b 指向了一块新的内存，a 还是指向原来的内存，所以最后两个输出不一样。</p>
<ol>
<li>module.exports 初始值为一个空对象 {}</li>
<li>exports 是指向的 module.exports 的引用</li>
<li>require() 返回的是 module.exports 而不是 exports</li>
</ol>
<p>我们经常看到这样的写法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exports = module.exports = &#123;...&#125;</div></pre></td></tr></table></figure></p>
<p>原理很简单：module.exports 指向新的对象时，exports 断开了与 module.exports 的引用，那么通过 exports = module.exports 让 exports 重新指向 module.exports。</p>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>这是个大话题，主要是用来控制异步流程的，改善回调函数。</p>
<ul>
<li>resolve(成功时，调用onFulfilled)</li>
<li>reject(失败时，调用onRejected)</li>
<li>pending(promise对象刚被创建后的初始化状态)<br><a href="http://es6.ruanyifeng.com/#docs/promise" target="_blank" rel="external">ES6入门</a></li>
</ul>
<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>必填字段</p>
<ul>
<li>name</li>
<li>version</li>
</ul>
<h3 id="npm-install"><a href="#npm-install" class="headerlink" title="npm install"></a>npm install</h3><ol>
<li><code>npm i express --save/npm i express -S</code> (安装 express，同时将 “express”: “^4.14.0” 写入 dependencies )</li>
<li><code>npm i express --save-dev/npm i express -D</code> (安装 express，同时将 “express”: “^4.14.0” 写入 devDependencies )</li>
<li><code>npm i express --save --save-exact</code> (安装 express，同时将 “express”: “4.14.0” 写入 dependencies )</li>
</ol>
<p>第三种方式将固定版本号写入 dependencies，建议线上的 Node.js 应用都采取这种锁定版本号的方式，因为你不可能保证第三方模块下个小版本是没有验证 bug 的，即使是很流行的模块。</p>
<h3 id="npm-shrinkwrap"><a href="#npm-shrinkwrap" class="headerlink" title="npm shrinkwrap"></a>npm shrinkwrap</h3><p>了彻底锁定依赖的版本，让你的应用在任何机器上安装的都是同样版本的模块（不管嵌套多少层），通过运行 npm shrinkwrap，会在当前目录下产生一个 npm-shrinkwrap.json，里面包含了通过 node_modules 计算出的模块的依赖树及版本。</p>
<p><em>只要目录下有 npm-shrinkwrap.json 则运行 npm install 的时候会优先使用 npm-shrinkwrap.json 进行安装，没有则使用 package.json 进行安装。</em></p>
<h2 id="express"><a href="#express" class="headerlink" title="express"></a>express</h2><h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>req 包含了请求来的相关信息，res 则用来返回该请求的响应</p>
<ul>
<li><code>req.query</code>: 解析后的 url 中的 querystring，如 <code>?name=haha</code>，req.query 的值为<code>{name: &#39;haha&#39;}</code></li>
<li><code>req.params</code>: 解析 url 中的占位符，如 <code>/:name</code>，访问 <code>/haha</code>，req.params 的值为 <code>{name: &#39;haha&#39;}</code></li>
<li><code>req.body</code>: 解析后请求体，需使用相关的模块，如 body-parser，请求体为 <code>{&quot;name&quot;: &quot;haha&quot;}</code>，则 req.body 为 <code>{name: &#39;haha&#39;}</code></li>
</ul>
<h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p>通过调用 <code>res.render</code> 函数渲染 ejs 模板.<br><code>res.render</code> 的作用就是将模板和数据结合生成 html，同时设置响应头中的 <code>Content-Type: text/html</code>，告诉浏览器我返回的是 html，不是纯文本，要按 html 展示。</p>
<ol>
<li><code>&lt;% code %&gt;</code>：运行 JavaScript 代码，不输出</li>
<li><code>&lt;%= code %&gt;</code>：显示转义后的 HTML内容</li>
<li><code>&lt;%- code %&gt;</code>：显示原始 HTML 内容</li>
</ol>
<blockquote>
<p>注意：&lt;%= code %&gt; 和 &lt;%- code %&gt; 都可以是 JavaScript 表达式生成的字符串，当变量 code 为普通字符串时，两者没有区别。当 code 比如为 </p><h1>hello</h1> 这种字符串时，&lt;%= code %&gt; 会原样输出 <h1>hello</h1>，而 &lt;%- code %&gt; 则会显示 H1 大的 hello 字符串。<p></p>
</blockquote>
<p>模板拆分<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;%- include(<span class="string">'header'</span>) %&gt;</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">name.toUpperCase</span>() %&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></div><div class="line">  &lt;p&gt;hello, <span class="xml"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">name</span> %&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></div><div class="line">&lt;%- include(<span class="string">'footer'</span>) %&gt;</div></pre></td></tr></table></figure></p>
<h3 id="express-中间件"><a href="#express-中间件" class="headerlink" title="express 中间件"></a>express 中间件</h3><p><code>express</code>中的中间件<code>middleware</code>就是用来处理请求的，当一个中间件处理完，可以通过调用 <code>next()</code> 传递给下一个中间件，如果没有调用 <code>next()</code>，则请求不会往下传递，如内置的 <code>res.render</code> 其实就是渲染完 html 直接返回给客户端，没有调用 <code>next()</code>，从而没有传递给下一个中间件。</p>
<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><ol>
<li><code>models</code>: 存放操作数据库的文件</li>
<li><code>public</code>: 存放静态文件文件，如样式、图片等</li>
<li><code>routes</code>: 存放路由文件</li>
<li><code>views</code>: 存放模板文件</li>
<li><code>index</code>.js: 程序主文件</li>
<li><code>package.json</code>: 存储项目名、描述、作者、依赖等等信息</li>
</ol>
<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>不管是小项目还是大项目，将配置与代码分离是一个非常好的做法。我们通常将配置写到一个配置文件里，如 config.js 或 config.json ，并放到项目的根目录下。但通常我们都会有许多环境，如本地开发环境、测试环境和线上环境等，不同的环境的配置不同，我们不可能每次部署时都要去修改引用 config.test.js 或者 config.production.js。config-lite 模块正是你需要的。</p>
<h4 id="config-lite"><a href="#config-lite" class="headerlink" title="config-lite"></a>config-lite</h4><p>config-lite 是一个轻量的读取配置文件的模块。config-lite 会根据环境变量（<code>NODE_ENV</code>）的不同从当前执行进程目录下的 config 目录加载不同的配置文件。如果不设置 NODE_ENV，则读取默认的 default 配置文件，如果设置了 NODE_ENV，则会合并指定的配置文件和 default 配置文件作为配置，config-lite 支持 .js、.json、.node、.yml、.yaml 后缀的文件。</p>
<p>总之，会根据你的<code>NODE_ENV=xxx node app</code> 根据<code>xxx</code>来查找文件目录里面所有的文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  port: <span class="number">3000</span>,</div><div class="line">  session: &#123;</div><div class="line">    secret: <span class="string">'myblog'</span>,</div><div class="line">    key: <span class="string">'myblog'</span>,</div><div class="line">    maxAge: <span class="number">2592000000</span></div><div class="line">  &#125;,</div><div class="line">  mongodb: <span class="string">'mongodb://localhost:27017/nblog'</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><code>mongodb</code>: <code>mongodb</code> 的地址，nblog 为 db 名</p>
<h3 id="RESTful-API-设计指南"><a href="#RESTful-API-设计指南" class="headerlink" title="RESTful API 设计指南"></a>RESTful API 设计指南</h3><p>这里主要介绍的是每个路由地址的跳转地址该如何设定（对此阶段并不要紧）</p>
<h3 id="会话"><a href="#会话" class="headerlink" title="会话"></a>会话</h3><p>####cookie </p>
<ul>
<li>服务器向客户端发送 cookie。<ul>
<li>通常使用 HTTP 协议规定的 set-cookie 头操作。</li>
<li>规范规定 cookie 的格式为 name = value 格式，且必须包含这部分。</li>
</ul>
</li>
<li>浏览器将 cookie 保存。</li>
<li>每次请求浏览器都会将 cookie 发向服务器。<br>每个域下最多存放50个cookie.一般来说，一个cookie不超过4KB，多余的会被清除。</li>
</ul>
<p>cookie 虽然很方便，但是使用 cookie 有一个很大的弊端，cookie 中的所有数据在客户端就可以被修改，数据非常容易被伪造，那么一些重要的数据就不能存放在 cookie 中了，而且如果 cookie 中数据字段太多会影响传输效率。为了解决这些问题，就产生了 session，session 中的数据是保留在服务器端的。</p>
<p>####session<br>session 的运作通过一个 <code>session_id</code> 来进行。<code>session_id</code> 通常是存放在客户端的 cookie 中，比如在 express 中，默认是 <code>connect.sid</code> 这个字段，当请求到来时，服务端检查 cookie 中保存的 <code>session_id</code> 并通过这个 <code>session_id</code> 与服务器端的 session data 关联起来，进行数据的保存和修改。</p>
<p>session 可以存放在 1）内存、2）cookie本身、3）redis 或 memcached 等缓存中，或者4）数据库中。线上来说，缓存的方案比较常见，存数据库的话，查询效率相比前三者都太低，不推荐；cookie session 有安全性问题，下面会提到。</p>
<p>初学者容易犯的一个错误是，忘记了 session_id 在 cookie 中的存储方式是 session cookie。即，当用户一关闭浏览器，浏览器 cookie 中的 session_id 字段就会消失。</p>
<h3 id="页面通知"><a href="#页面通知" class="headerlink" title="页面通知"></a>页面通知</h3><p>我们还需要这样一个功能：当我们操作成功时需要显示一个成功的通知，如登录成功跳转到主页时，需要显示一个 <code>登陆成功</code> 的通知；当我们操作失败时需要显示一个失败的通知，如注册时用户名被占用了，需要显示一个 <code>用户名已占用</code> 的通知。通知只显示一次，刷新后消失，我们可以通过 connect-flash 中间件实现这个功能。<br><code>connect-flash</code> 是基于 session 实现的，它的原理很简单：设置初始值 req.session.flash={}，通过 <code>req.flash(name, value)</code>设置这个对象下的字段和值，通过 <code>req.flash(name)</code> 获取这个对象下的值，同时删除这个字段。<br>(有点类似于<code>localStorage</code>啊)</p>
<h4 id="express-session、connect-mongo-和-connect-flash-的区别与联系"><a href="#express-session、connect-mongo-和-connect-flash-的区别与联系" class="headerlink" title="express-session、connect-mongo 和 connect-flash 的区别与联系"></a>express-session、connect-mongo 和 connect-flash 的区别与联系</h4><ol>
<li><code>express-session</code>: 会话（session）支持中间件</li>
<li><code>connect-mongo</code>: 将 session 存储于 mongodb，需结合 express-session 使用，我们也可以将 session 存储于 redis，如 connect-redis</li>
<li><code>connect-flash</code>: 基于 session 实现的用于通知功能的中间件，需结合 express-session 使用</li>
</ol>
<h3 id="webcomponent"><a href="#webcomponent" class="headerlink" title="webcomponent"></a>webcomponent</h3><p>在调用 <code>res.render</code> 的时候，express 合并（merge）了 3 处的结果后传入要渲染的模板，<code>res.render</code> 传入的对象&gt; <code>res.locals</code> 对象 &gt; <code>app.locals</code> 对象，所以 <code>app.locals</code> 和 <code>res.locals</code> 几乎没有区别，都用来渲染模板，使用上的区别在于：<code>app.locals</code> 上通常挂载常量信息（如博客名、描述、作者信息），<code>res.locals</code> 上通常挂载变量信息，即每次请求可能的值都不一样（如请求者信息，<code>res.locals.user = req.session.user</code>）。</p>
<h3 id="Mongolass"><a href="#Mongolass" class="headerlink" title="Mongolass"></a>Mongolass</h3><p>更详细的错误信息提醒。</p>
<h3 id="用户模型设计"><a href="#用户模型设计" class="headerlink" title="用户模型设计"></a>用户模型设计</h3><blockquote>
<p>小提示：Mongolass 中的 model 你可以认为相当于 mongodb 中的 collection，只不过添加了插件的功能。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">exports.User = mongolass.model(<span class="string">'User'</span>,&#123;</div><div class="line">    name: &#123;type: <span class="string">'string'</span>&#125;,</div><div class="line">    password: &#123;type: <span class="string">'string'</span>&#125;,</div><div class="line">    avatar: &#123;type: <span class="string">'string'</span>&#125;,</div><div class="line">    gender: &#123;type: <span class="string">'string'</span>, enum: [<span class="string">'m'</span>, <span class="string">'f'</span>, <span class="string">'x'</span>]&#125;,</div><div class="line">    bio: &#123;type: <span class="string">'string'</span>&#125;</div><div class="line">&#125;);</div><div class="line">exports.User.index(&#123;name: <span class="number">1</span>&#125;, &#123;unique: <span class="literal">true</span>&#125;).exec();<span class="comment">//根据用户名找到用户，且全局唯一</span></div></pre></td></tr></table></figure>
<p>定义用户表的schema，并导出<code>User</code>这个模型</p>
<ol>
<li>在view下新建<code>signup.ejs</code></li>
<li>在routes建立一个路由，跳转到注册页<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// GET /signup 注册页</span></div><div class="line">router.get(<span class="string">'/'</span>, checkNotLogin, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  res.render(<span class="string">'signup'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>因为我们的index.js下设定了模板的地址，所以可以直接使用signup。</p>
<h3 id="注册与文件上传"><a href="#注册与文件上传" class="headerlink" title="注册与文件上传"></a>注册与文件上传</h3><ol>
<li><p>在index.js下增加处理表单的中间件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 处理表单及文件上传的中间件</div><div class="line">app.use(require(&apos;express-formidable&apos;)(&#123;</div><div class="line">    uploadDir: path.join(__dirname, &apos;public/img&apos;),// 上传文件目录</div><div class="line">    keepExtensions: true// 保留后缀</div><div class="line">&#125;));</div></pre></td></tr></table></figure>
</li>
<li><p>model层新建文件<br><code>models/users.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> User = <span class="built_in">require</span>(<span class="string">'../lib/mongo'</span>).User;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="comment">// 注册一个用户</span></div><div class="line">  create: <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">user</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> User.create(user).exec();</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>完善注册的路由<br>因为是注册后的数据需要写入到数据库。先获取表单中的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">var UserModel = require(&apos;../models/users&apos;);</div><div class="line">router.post(&apos;/&apos;, checkNotLogin, function(req, res, next) &#123;</div><div class="line">  var name = req.fields.name;</div><div class="line">  var gender = req.fields.gender;</div><div class="line">  var bio = req.fields.bio;</div><div class="line">  var avatar = req.files.avatar.path.split(path.sep).pop();</div><div class="line">  var password = req.fields.password;</div><div class="line">  var repassword = req.fields.repassword;</div><div class="line">  //...</div><div class="line">  try&#123;</div><div class="line">        //填写的字段验证</div><div class="line">    &#125;catch(e)&#123;</div><div class="line">        //</div><div class="line">    &#125;</div><div class="line">    // 明文密码加密</div><div class="line">  password = sha1(password);</div><div class="line"></div><div class="line">    // 待写入数据库的用户信息</div><div class="line">  var user = &#123;</div><div class="line">    name: name,</div><div class="line">    password: password,</div><div class="line">    gender: gender,</div><div class="line">    bio: bio,</div><div class="line">    avatar: avatar</div><div class="line">  &#125;;</div><div class="line">  //key是我们之前定义的模型，后面的value是我们将传入的值</div><div class="line"></div><div class="line">    // 用户信息写入数据库</div><div class="line">    UserModel.create(user).then(function(result)&#123;</div><div class="line">        //这里的result里的数据就是已经从数据库里获取的了</div><div class="line">        //所以此user 是插入 mongodb 后的值，包含 _id</div><div class="line">        user = result.opts[0];</div><div class="line">        //将用户信息存入 session</div><div class="line">        //密码删除了再存入到session,确保安全么？</div><div class="line">        delete user.password;</div><div class="line">        req.session.user = user;</div><div class="line">        // 写入 flash</div><div class="line">        req.flash(&apos;success&apos;, &apos;注册成功&apos;);</div><div class="line">          // 跳转到首页</div><div class="line">        res.redirect(&apos;/posts&apos;);</div><div class="line">        &#125;).catch(function(e)&#123;</div><div class="line">            // 用户名被占用则跳回注册页，而不是错误页</div><div class="line">            if(e.message.match(&apos;E11000 duplicate key&apos;))&#123;</div><div class="line">                req.flash(&apos;error&apos;, &apos;用户名已被占用&apos;);</div><div class="line">                return res.redirect(&apos;/signup&apos;);</div><div class="line">            &#125;</div><div class="line">            next(e);</div><div class="line">            &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/24/Node学习笔记/" itemprop="url">
                  Node学习笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-24T13:33:19+08:00" content="2016-10-24">
              2016-10-24
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/24/Node学习笔记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/24/Node学习笔记/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>node是采用CMD模块系统，主模块作为程序入口，所有模块在执行中只初始化一次。</p>
<h3 id="从模块到包"><a href="#从模块到包" class="headerlink" title="从模块到包"></a>从模块到包</h3><p>我们已经知道了JS模块的基本单位是单个JS文件，但复杂些的模块往往由多个子模块组成。为了便于管理和使用，我们可以把由多个子模块组成的大模块称做包，并把所有子模块放在同一个目录里。</p>
<blockquote>
<ul>
<li>/home/user/lib/<ul>
<li>cat/<br>  head.js<br>  body.js<br>  main.js</li>
</ul>
</li>
</ul>
</blockquote>
<p>假设这是文件目录，<code>main.js</code>作为入口模块，其内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var head = require(&quot;head&quot;);</div><div class="line">var body = require(&quot;body&quot;);</div><div class="line"></div><div class="line">exports.create = function(name)&#123;</div><div class="line">    return &#123;</div><div class="line">        name: name,</div><div class="line">        head: head.create(),</div><div class="line">        body: body.create()</div><div class="line">    &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>然后在你需要导入的文件下写<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var cat = require(&apos;/home/user/lib/cat/main&apos;);</div></pre></td></tr></table></figure></p>
<p>这样，该文件就引入了包。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/15/响应式网站初探/" itemprop="url">
                  响应式网站初探
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-15T19:25:33+08:00" content="2016-10-15">
              2016-10-15
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/15/响应式网站初探/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/15/响应式网站初探/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>响应式网站核心理念<br>（这是一种设计理念）</p>
<ul>
<li>flexible grid layout 弹性网格布局</li>
<li>flexible image 弹性图片</li>
<li>media queries 媒体查询</li>
</ul>
<h2 id="css3媒体查询"><a href="#css3媒体查询" class="headerlink" title="css3媒体查询"></a>css3媒体查询</h2><h3 id="逻辑操作符"><a href="#逻辑操作符" class="headerlink" title="逻辑操作符"></a>逻辑操作符</h3><ul>
<li>only 表示仅在媒体查询匹配成功的情况下应用该指定样式。可以通过它选中的样式在老浏览器中不被使用</li>
<li>and 操作符把多个媒体属性集合，当每个属性都为真时，查询结果才为真</li>
<li>not 操作符表示对一条媒体查询取反结果<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@media tv and (min-width: 700px) and (orientation: landscape) &#123; ... &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>现在，上面媒体查询仅在电视媒体上，可视区域不小于700像素宽度并且是横屏时有效。</p>
<h3 id="逗号分隔列表"><a href="#逗号分隔列表" class="headerlink" title="逗号分隔列表"></a>逗号分隔列表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@media (min-width: 700px), handheld and (orientation: landscape) &#123; ... &#125;</div></pre></td></tr></table></figure>
<p>媒体查询中使用逗号分隔效果等同于 or 逻辑操作符。满足任意条件即可</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Media_queries" target="_blank" rel="external">MDN CSS媒体查询</a></p>
<h3 id="meta"><a href="#meta" class="headerlink" title="meta"></a>meta</h3><p>如果设置了 name , 它是一个文档级的元数据，将附着在整个页面上。<br>如果设置了 http-equiv , 它是一个编译指令， 即，由服务器提供的来指示页面应如何加载。<br>如果设置了  charset， 即，将对网页使用的字符集作出声明 HTML5<br>如果设置了  itemprop，将定义一个用户自定义的元数据，也因此语义声明，这个定义将对用户代理完全开放。Living Standard 未实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no&quot; /&gt;</div></pre></td></tr></table></figure></p>
<p>ViewPort <meta>标记用于指定用户是否可以缩放Web页面，如果可以，那么缩放到的最大和最小缩放比例是什么。使用ViewPort <meta>标记还表示文档针对移动设备进行了优化。ViewPort <meta>标记的content值是由指令及其值组成的以逗号分隔的列表。</p>
<p><a href="https://gist.github.com/Jimco/9524062" target="_blank" rel="external">完整的meta预览</a></p>
<p>设置了viewport后还需要关注的是<code>width</code>(视口宽度)<br>移动端中<code>width</code>的不同概念</p>
<ul>
<li>布局视口，用户缩放不可改变，PC的网站在移动端浏览时会先按照PC端的大小进行渲染</li>
<li>可视视口（用户缩放可以改变可视视口，默认宽度为屏幕宽度）</li>
<li>理想视口 是移动端在浏览页面时的最佳视口，为优化手机浏览器而添加的</li>
</ul>
<p>理想视口就是为构建手机浏览器优化的页面而添加.<br>可视视口(visual viewport)–在手机上呈现出来的一个宽度，用户的缩放可以改变可视视口的大小，是不会改变布局视口的大小的；<br>布局视口(layout viewport)–用一个虚拟的960px的宽度把网页先布局出来，大小是不变的；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;ie=edge&quot; /&gt;</div><div class="line">&lt;!-- iE文档兼容性 强制使用以最新的IE浏览器进行渲染--&gt;</div></pre></td></tr></table></figure>
<p>如果是必不可少的图片建议采用img引入，<br>如果只是装饰性的图片可以使用标签的style引入。<br>避免当用户禁用样式时屏蔽了必要的图片</p>
<ul>
<li><p>em<br>相对长度单位，这个单位表示元素的font-size的计算值。如果用在font-size 属性本身，它会继承父元素的font-size。<br>假设当前设置<code>font-size:0</code>， 浏览器会有一个默认的em设置<code>1em = 16px</code>;</p>
</li>
<li><p>rem<br>相对参照物为根元素<code>&lt;html&gt;</code>的<code>font-size</code>大小。</p>
</li>
<li><p>vw<br>视口宽度的 1/100。</p>
</li>
<li><p>px<br>与显示设备相关。<br>对于屏幕显示，通常是一个设备像素（点）的显示。<br>对于打印机和高分辨率的屏幕，一个CSS像素意味着多个设备像素，因此，每英寸的像素的数量保持在96左右。</p>
</li>
</ul>
<h3 id="创建文件"><a href="#创建文件" class="headerlink" title="创建文件"></a>创建文件</h3><ol>
<li>建立404页面（4.4.html）:找不到正确页面，跳转到的页面；替换服务器上默认的错误页页面； </li>
<li>创建robots.txt文件（机器人：给机器看的，给搜索引擎看的）：是搜索引擎访问网站时查看的第一个文件，这个文件告诉引擎什么能查看，什么不能查看；</li>
<li>创建favicon.ico文件：网站的logo，在网站的标签上显示；</li>
<li>创建humans.txt文件（人类：给人看的）：保存网站建设者和一些其他的有用的信息</li>
</ol>
<h3 id="制作过程中遇到的问题："><a href="#制作过程中遇到的问题：" class="headerlink" title="制作过程中遇到的问题："></a>制作过程中遇到的问题：</h3><h4 id="断点的单位"><a href="#断点的单位" class="headerlink" title="断点的单位"></a>断点的单位</h4><p>在媒体查询中，相对单位rem和em的基准高于html，所以与在html中设置的rem大小并不一致！这里的rem或em依然是：1rem=1em=16px，所以800/16=50rem。另外，rem兼容性不如em，故采用兼容性更好的em为媒体查询的断点单位。</p>
<h4 id="line-block-空白符解析会产生间隙"><a href="#line-block-空白符解析会产生间隙" class="headerlink" title="line-block 空白符解析会产生间隙"></a>line-block 空白符解析会产生间隙</h4><p>解决这种问题的方式有以下几种： </p>
<ol>
<li>消除HTML代码中元素间的空白 </li>
<li>设置父元素的font-size:0;（有副作用） </li>
<li>子元素不闭合，浏览器自动补全</li>
<li>子元素设置负边距，不同浏览器间距不一 </li>
<li>设置子元素样式：white-space-collapsing(css4属性，兼容性不好)</li>
</ol>
<h4 id="媒体查询中的像素（em-pxd等）"><a href="#媒体查询中的像素（em-pxd等）" class="headerlink" title="媒体查询中的像素（em,pxd等）"></a>媒体查询中的像素（em,pxd等）</h4><p>媒体查询中设置了<code>px</code>的话是浏览器默认的样式，脱离了css设置的优先级，所以在媒体查询中<code>1em = 16px</code>。</p>
<h4 id="chrome默认字体"><a href="#chrome默认字体" class="headerlink" title="chrome默认字体"></a>chrome默认字体</h4><p>Chrome有一个下限，中文为12px，如果设置<code>font-size=10px;line-heigh=3rem</code>，实为36px，而不是30px。</p>
<h4 id="清除浮动"><a href="#清除浮动" class="headerlink" title="清除浮动"></a>清除浮动</h4><p>清除浮动3种方法—-触发BFC（上下文格式化）即可： 1）给盒子最末尾添加带有clear:both;属性的盒子； 2）给盒子添加overflow:hidden;属性； 3）给盒子添加伪元素的类名.clearfix：after{ content:”.”; height:”0”; visible:hidden: clear:both; }; 最常采用方法： 添加类名.clearfix:before,.clearfix:after{ content:””; display-block:table; } .clearfix:after{ clear:both; }</p>
<p>css3选择器</p>
<p>js控制图片加载</p>
<pre><code>//通过cookie进行设置也可以

srcset
srcset 配合 sizes
picture
svg

浏览器默认行为

&lt;img src=&quot;&quot; alt=&quot;&quot; srcset=&quot;img/480.png 480w, img/800.png 800w&quot; sizes=&quot;100vw&quot; &gt;//

图片尺寸表示100%视口宽度，即使父容器宽度设置为50%，依然会按照视口宽度来进行

图片格式
</code></pre><p>1、gulp-watch：监听文件，如果文件有改动自动执行任务 2、gulp-postcss：与autoprefixer结合，自动给一些css添加前缀 3、gulp-concat：多个文件合并成一个文件 4、gulp-responsive：实现响应式图片插件</p>
<p>margin-top下盒子 和 margin-bottom上盒子会发生叠加，产生浏览器顶端空白崩溃 :before{content:””;display:table}防止叠加</p>
<p><header> <footer> <section> 相当于特殊的section： <nav>导航 <article>文章 html5标签新规定： <b>加粗，吸引人注意，可是没有强调的意思 <em>重点强调的文字 <i>有不同的语态语气，如有反讽的语气</i></em></b></article></nav></section></footer></header></p>
<p>浏览器支持状态<br>use i use usage-table<br><a href="http://gs.statcounter.com/#browser-CN-monthly-201509-201609" target="_blank" rel="external">gs.statcounter.com</a><br>[x5.tencent.com] 腾讯QQ浏览器内核</p>
<p>移动端浏览器测试： 1.如果要真机，去www.umindex.com查看各机型活跃度，针对性购买 2.云测试，www.testin.cn 3.安卓虚拟机模拟器，www.genymotion.net</p>
<p>autoprefixer.github.io(工具转</p>
<p>bitbug.net 将图片转化为icon图标<br>dilingor.io</p>
<p>csshack</p>
<p>broswerhacks </p>
<p>html5shiv</p>
<p>modernizer</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/13/轮播图组件/" itemprop="url">
                  轮播图组件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-13T18:12:16+08:00" content="2016-10-13">
              2016-10-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/13/轮播图组件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/13/轮播图组件/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/11/图片异步加载/" itemprop="url">
                  图片加载的策略
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-11T20:58:59+08:00" content="2016-10-11">
              2016-10-11
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/11/图片异步加载/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/11/图片异步加载/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>懒加载：延迟加载图片或符合某些条件时才加载某些图片。<br>预加载：提前加载图片，当用户需要查看时可直接从本地缓存中渲染。<br>两种技术的本质：两者的行为是相反的，一个是提前加载，一个是迟缓甚至不加载。懒加载对服务器前端有一定的缓解压力作用，预加载则会增加服务器前端压力。</p>
<h3 id="懒加载（延迟加载）"><a href="#懒加载（延迟加载）" class="headerlink" title="懒加载（延迟加载）"></a>懒加载（延迟加载）</h3><p>页面打开时候，只加载第一屏数据，第二屏以上都用延迟加载，滚动的时候进行加载（如瀑布流）。这样可以显著提高页面加载速度，且更小的并发请求也可以减轻服务器的压力，而且如果用户只浏览首屏的话，还可以节省流量（手机客户端应该用的比较多，减少用户流量）。</p>
<p>比如你看到的一些图片是有圈圈在转，一开始图片的src加载的时候是转转的圈圈（可能也就1K左右），然后根据用户的具体行为再进行图片的延迟加载。</p>
<h3 id="预加载"><a href="#预加载" class="headerlink" title="预加载"></a>预加载</h3><p>预加载：提前加载图片，当用户需要查看时可直接从本地缓存中渲染。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">function loadImage(url, callback)&#123;</div><div class="line">    var img = new Image();</div><div class="line">    img.src = url;</div><div class="line"></div><div class="line">    if(img.complete) &#123;//判断图片加载状态，兼容IE6。</div><div class="line">        //如果图片已经存在浏览器中，直接调用回调函数</div><div class="line">        callback.call(img);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    img.onload = function()&#123;</div><div class="line">        img.onload = null;</div><div class="line">        callback.call(img);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;img src=&quot;http://img3.douban.com/lpic/s24418088.jpg&quot; alt=&quot;&quot; id=&quot;img&quot;&gt;</div><div class="line">    &lt;script&gt;</div><div class="line">        window.onload = function()&#123;</div><div class="line">            var img = new Image();</div><div class="line">            img.onload = function()&#123;</div><div class="line">                alert(&quot;加载完全&quot;);</div><div class="line">            &#125;</div><div class="line">            img.src = &quot;http://www.2cto.com/uploadfile/Collfiles/20141017/2014101709072456.png&quot;;</div><div class="line">            </div><div class="line">            var img = document.getElementById(&quot;img&quot;);</div><div class="line">            img.onmouseover = function()&#123;</div><div class="line">                img.src = &quot;http://www.2cto.com/uploadfile/Collfiles/20141017/2014101709072456.png&quot;;</div><div class="line">            &#125;;</div><div class="line">            img.onmouseout = function()&#123;</div><div class="line">                img.src= &quot;http://img3.douban.com/lpic/s24418088.jpg&quot;;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &lt;/script&gt;</div></pre></td></tr></table></figure>
<h3 id="国外网站的流行加载方式"><a href="#国外网站的流行加载方式" class="headerlink" title="国外网站的流行加载方式"></a>国外网站的流行加载方式</h3><p>Pinterest\Google的图片加载方式是先加载出一个与原图片相同大小与相似背景的纯色<code>DIV</code>。（利用聚合算法求出相近的背景色）<br>然后再加载完整的图片。<img src="http://img1.vued.vanthink.cn/vued058f4fcad7f61f95e7682b64178511ef.png" alt="image"><br>详情查看<a href="">演示地址</a><br>我们称之为这种效果为Color Placeholder [色彩预置]，当图片加载的时候，我们优先显示其所在容器的背景颜色（如同很多会显示一个加载的gif），由于受限于不同的图片和大小，因此相比与齐刷刷的加载gif，不同色块体验可能更好吧(至少Pinterest Google这么认为吧)。</p>
<p>medium的做法先加载一张缩略图，给缩略图添加滤镜效果，缩略图添加完成后再加载大图。这样就给用户一种平滑过渡的效果，效果非常赞（有种毛玻璃的感觉）。<br>原作者将代码放到了<a href="http://codepen.io/jmperez/pen/yYjPER" target="_blank" rel="external">codepen</a>上,而作者也适用了CSS的blur滤镜。（代码中的图片来源需要翻墙获得）<br>为了方便演示，我直接下载下来，可以通过<a href="">演示地址</a>去查看源代码。</p>
<p>这样做的好处是：</p>
<ul>
<li>延迟加载：使用JS控制图片加载可以自由的控制什么样的图片去完成加载，当所有的小图完成加载后，JS可以实现加载在所在可视区域的大图完成渲染。</li>
<li>更好内容预置：那些缩略图很小，几乎2kb左右，再加模糊效果，这样的效果会比单纯的底色好很多。</li>
<li>定制图片大小：Medium定制了很多不同的图片，根据用户的不同设备，从而展示出不一样大小的图片。</li>
</ul>
<p><a href="http://www.cnblogs.com/tugenhua0707/p/3515292.html" target="_blank" rel="external">JS图片延迟加载分析及简单的demo</a><br><a href="http://www.cnblogs.com/Leo_wl/p/3526254.html" target="_blank" rel="external">javascript图片懒加载与预加载的分析</a><br><a href="http://www.jackpu.com/shi-xian-lei-si-pinterest-de-tu-pian-yu-jia-zai-gong-neng/" target="_blank" rel="external">实现类似Pinterest 的图片预加载功能</a><br><a href="http://www.jackpu.com/medium-shi-ru-he-zuo-tu-pian-jia-zai-de/" target="_blank" rel="external">[译]Medium 是如何优化图片加载的</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Zaynex" />
          <p class="site-author-name" itemprop="name">Zaynex</p>
          <p class="site-description motion-element" itemprop="description">但行好事，莫问前程</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">80</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">74</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Zaynex" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/xi-wen-zheng" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-zhihu"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zaynex</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zaynex"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
